/* (c) Mathigon */
(function(){'use strict';function nearlyEquals(e,a,s=tolerance){return _Mathabs(e-a)<s}function isBetween(e,s,a,n=tolerance){if(s>a){var t=[a,s];s=t[0],a=t[1]}return e>s+n&&e<a-n}function fmt(e){let a=('00'+e).substr(-3),s=a[0],n=a[1],t=a[2];return[0===+s?'':ONES[s]+' hundred ',0===+t?TENS[n]:TENS[n]&&TENS[n]+'-'||'',ONES[n+t]||ONES[t]].join('')}function cons(e,t,a){return t?[t,a&&' '+a||'',' ',e].join(''):e}function toWord(e){if(!e)return'zero';let t='',a=0;for(;e;)t=cons(t,fmt(e%1e3),MULTIPLIERS[a]),a+=1,e=0|e/1e3;return t.trim()}function _round(e,t=0){let a=_Mathpow(10,t);return _Mathround(e*a)/a}function roundTo(e,t=1){return _Mathround(e/t)*t}function noop(){}function run(e,...t){return e instanceof Function?e(...t):e}function isOneOf(e,...t){for(let a of t)if(e===a)return!0;return!1}function deepExtend(e,t){for(let a of Object.keys(t))a in e&&Array.isArray(e[a])&&Array.isArray(t[a])?e[a]=e[a].concat(t[a]):a in e&&e[a]instanceof Object&&t[a]instanceof Object?deepExtend(e[a],t[a]):e[a]=t[a]}function clamp(e,t=-Infinity,a=Infinity){return _Mathmin(a,_Mathmax(t,e))}function square(e){return e*e}function delay(e,a=0){return a?setTimeout(e,a):void e()}function defer(){let e,t;const a=new Promise((a,s)=>{e=a,t=s});return a.catch(function(e){return e}),{promise:a,resolve:e,reject:t}}function throttle(e,a=0){let t=!1,s=!1;return function(...n){t?s=!0:(e.apply(null,n),t=!0,setTimeout(function(){s&&e(...n),t=!1,s=!1},a))}}function _tabulateWith(e,t,a){if(!a.length)return run(e,...t);let s=a.slice(0),n=s.shift(),o=[];for(let r=0;r<n;++r)o.push(_tabulateWith(e,t.concat([r]),s));return o}function tabulate(e,...t){return _tabulateWith(e,[],t)}function list(e,t,a=1){let s=[];if(null==t&&0<=e)for(let t=0;t<e;t+=a)s.push(t);else if(null==t)for(let t=0;t>e;t-=a)s.push(t);else if(e<=t)for(let n=e;n<=t;n+=a)s.push(n);else for(let n=e;n>=t;n-=a)s.push(n);return s}function last(e,t=0){return e[e.length-1-t]}function total(e){return e.length?+e.reduce((e,t)=>e+(+t||0)):0}function contains(e,t){return 0<=e.indexOf(t)}function zip(e,t){let a={};for(let s=0;s<e.length;++s)a[e[s]]=t[s];return a}function sortBy(e,t,s=!1){return e.slice(0).sort((e,a)=>e[t]<a[t]?s?1:-1:e[t]>a[t]?s?-1:1:0)}function sortByFn(e,t,s=!1){return e.slice(0).sort((e,a)=>{let n=t(e),i=t(a);return n<i?s?1:-1:n>i?s?-1:1:0})}function loop(e){let t=-1;return function(){return t=(t+1)%e.length,e[t]}}function without(e,t){return e.filter((e)=>e!==t)}function flatten(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?flatten(t):t),[])}function cumulative(e){let t=0;return e.map((e)=>t+=e)}function difference(e,t){let a=t.filter((t)=>!e.includes(t)),s=e.filter((e)=>!t.includes(e));return[...a,...s]}function toLinkedList(e){const t=e.map((e)=>({val:e,next:null})),a=t.length;for(let s=0;s<a;++s)t[s].next=t[(s+1)%a];return t}function process(e,t){return t.lowercase&&(e=e.toLowerCase()),e.split(t.split).map((t)=>t.trim())}function words(e){return e?e.trim().split(/\s+/):[]}function toCamelCase(e){return e.toLowerCase().replace(/^-/,'').replace(/-(.)/g,(e,t)=>t.toUpperCase())}function repeat(e,t=1){for(let a=1;a<t;++a)e+=e;return e}function stringDistance(e,t){let a=tabulate(0,e.length+1,t.length+1);for(let s=0;s<=e.length;s++)a[s][0]=s;for(let s=0;s<=t.length;s++)a[0][s]=s;for(let s=1;s<=e.length;s++)for(let n=1;n<=t.length;n++)a[s][n]=_Mathmin(a[s-1][n-1]+(e.charAt(s-1)===t.charAt(n-1)?0:1),a[s-1][n]+1,a[s][n-1]+1);return a[e.length][t.length]}function autocorrect(e,t){let a=e.length/2,s=t.map((t)=>({w:t,d:stringDistance(e,t)})).filter(({d:e})=>e<a),n=sortBy(s,'d')[0];return n?n.w:null}function isString(e){return e instanceof String||'string'==typeof e}function isNumber(e){return e instanceof Number||'number'==typeof e}function isArray(e){return Array.isArray(e)}function facRec(e,t){return 1>=e?e:e*facRec(e-1,t)}function factorial(e){return 0===e?1:0>e?NaN:facRec(e,1)}function permutations(e){function t(e){for(let n,o=0;o<e.length;o++)n=e.splice(o,1)[0],s.push(n),0===e.length&&a.push(s.slice()),t(e),e.splice(o,0,n),s.pop();return a}let a=[],s=[];return t(e)}function _getSubsets(e){if(1===e.length)return[[],e];let t=e.pop(),a=_getSubsets(e),n=[];for(let i of a){let e=i.slice(0);e.push(t),n.push(i,e)}return n}function subsets(e,t=0){let a=e.slice(0),s=_getSubsets(a);return t&&(s=s.filter((e)=>e.length===t)),s}function substitute(e,t){if(isNumber(e))return e;if(isString(e))return e in t?t[e]:e;let a=e[0],s=e.slice(1);return s=s.map((e)=>substitute(e,t)),[a,...s]}function same(e,t){if(e===t)return!0;if(!isArray(e)||!isArray(t))return!1;if(e[0]!=t[0])return!1;let a=e[0],s=e.slice(1),n=t.slice(1);if('+*'.includes(a)){let e=permutations(s);return e.some((e)=>e.every((e,t)=>same(e,n[t])))}return s.every((e,t)=>same(e,n[t]))}function flattenAssociative(e){if(isString(e)||isNumber(e))return e;let t=e[0],s=e.slice(1);if(s=s.map((e)=>flattenAssociative(e)),!'+*'.includes(t))return[t,...s];let n=[];for(let i of s)isArray(i)&&i[0]==t?n.push(...i.slice(1)):n.push(i);return[t,...n]}function mergePlaceholders(e){if(!e.length)return[];for(let t of e)if(!t.length)return[];let t=tabulate(function(...t){let a=t.map((t,a)=>e[a][t]),s={};for(let e of a){if(!e)return null;for(let t of Object.keys(e))if(!(t in s))s[t]=e[t];else if(!same(s[t],e[t]))return null}return s},...e.map((e)=>e.length));return flatten(t).filter((e)=>!!e)}function match(e,t){if(isNumber(t))return e===t?[{}]:[];if(isString(t))return'c'==t[0]?isNumber(e)?[{[t]:e}]:[]:'v'==t[0]?isString(e)?[{[t]:e}]:[]:[{[t]:e}];if(!isArray(e))return[];let a=e[0],s=e.slice(1);if(a!=t[0])return[];if(e.length!=t.length)return[];if('+*'.includes(e[0])){for(let e of permutations(s)){let a=mergePlaceholders(e.map((e,a)=>match(e,t[a+1])));if(a.length)return a}return[]}return mergePlaceholders(s.map((e,a)=>match(e,t[a+1])))}function rewrite(e,t){if(isString(e)||isNumber(e))return e;let a=e[0],s=e.slice(1);s=s.map((e)=>rewrite(e,t));let n=t[0],i=n[0],o=n.slice(1);if('+*'.includes(a)&&'+*'.includes(i)&&s.length>o.length){for(let e of subsets(list(s.length),o.length)){let n=e.map((e)=>s[e]),i=s.filter((t,a)=>!e.includes(a)),o=match([a,...n],t[0])[0];if(o){let e=substitute(t[1],o);return flattenAssociative([a,e,...i])}}return[a,...s]}let r=match([a,...s],t[0])[0];return r?substitute(t[1],r):[a,...s]}function simplify(e){HAS_GENERATED_RULES||(REWRITE_RULES=REWRITE_RULES.map((e)=>[parseString(e[0]),parseString(e[1])]).reverse(),HAS_GENERATED_RULES=!0);for(let t=toString(e),a=null;a!=t;){a=t,e=evaluate(e),e=flattenAssociative(e);for(let t of REWRITE_RULES)e=rewrite(e,t);t=toString(e)}return e}function evaluate(e,t={}){if(isNumber(e))return e;if(isString(e))return e in t?t[e]:e in CONSTANTS?CONSTANTS[e]:e;let a=e[0],s=e.slice(1);if(s=s.map((e)=>evaluate(e,t)),s.every((e)=>isNumber(e))){if(a in t)return t[a](...s);if(a in FN_EVALUATE)return FN_EVALUATE[a](...s);if(a in Math)return Math[a](...s)}else if('+*'.includes(a)){let e=FN_EVALUATE[a](...s.filter((e)=>isNumber(e))),t=s.filter((e)=>!isNumber(e));return[a,e,...t]}return[a,...s]}function stringify(e){if(isNumber(e)||isString(e))return e;let t=e[0],a=e.slice(1);return a=a.map((e)=>isArray(e)?`(${stringify(e)})`:stringify(e)),t in FN_STRINGIFY?FN_STRINGIFY[t](...a):t+'('+a.join(', ')+')'}function variables(e){if(isNumber(e))return[];if(isString(e))return[e];let t=[];for(let s of e.slice(1))for(let e of variables(s))t.includes(e)||t.push(e);return t}function functions(e){if(isNumber(e)||isString(e))return[];let t=[e[0]];for(let s of e.slice(1))for(let e of functions(s))t.includes(e)||t.push(e);return t}function findBinaryFunction(e,t){for(let s=0;s<e.length;++s)if(t.includes(e[s])){let t=e[s-1],a=e[s+1];if(null==a)throw new ExprError('SyntaxError',`An expression cannot end with a "${e[s]}".`);if('+-*/^%!'.includes(t))throw new ExprError('SyntaxError',`A "${t}" cannot be followed by a "${e[s]}".`);if('+-*/^%!'.includes(a))throw new ExprError('SyntaxError',`A "${e[s]}" cannot be followed by a "${a}".`);e.splice(s-1,3,[e[s],t,a]),s-=2}}function parseMaths(e){for(let a,s=0;s<e.length;++s)a=e[s],a==+a&&(e[s]=+a);if('+*/^%!'.includes(e[0]))throw new ExprError('SyntaxError',`A term cannot start with a "${e[0]}".`);for(let t=0;t<e.length;++t)'!%'.includes(e[t])&&(e.splice(t-1,2,[e[t],e[t-1]]),t-=1);findBinaryFunction(e,'^'),findBinaryFunction(e,'*/');for(let t=0;t<e.length-1;++t)'+-*/^%!'.includes(e[t])||'+-*/^%!'.includes(e[t+1])||(e.splice(t,2,['*',e[t],e[t+1]]),t-=1);if('-\xB1'.includes(e[0])&&e.splice(0,2,[e[0],e[1]]),findBinaryFunction(e,'+-\xB1'),findBinaryFunction(e,'=<>\u2264\u2265'),1<e.length)throw new ExprError('SyntaxError',`This expression is invalid.`);return e[0]}function matchBrackets(e){let a=[];for(let s,t=0;t<e.length;++t){if(s=e[t],')]}'.includes(s)||'|'==s&&0<t)return[parseMaths(a),e.slice(t)];if('([{|'.includes(s)){let n=a.pop();if('%!'.includes(n))throw new ExprError('SyntaxError',`A "${n}" cannot be followed by a "${s}".`);let i=matchBrackets(e.slice(t+1)),o=i[0],r=i[1],l=r[0],d=r.slice(1);if(l!=BRACKETS[s])throw new ExprError('SyntaxError',`The brackets "${s}" and "${l}" don’t match.`);'|'==s&&(o=['abs',o]),n&&n.match(/^\w+$/)&&n!=+n?a.push([n,o]):n?a.push(n,o):a.push(o),e=d,t=-1}else a.push(s)}return[parseMaths(a),[]]}function parseString(e){let t=e.replace(TOKEN_REGEX,'').trim();if(t)throw new ExprError('SyntaxError',`The character "${t[0]}" is invalid.`);let a=e.match(TOKEN_REGEX);for(let t=0;t<a.length;++t)a[t]in TOKEN_REPLACE&&(a[t]=TOKEN_REPLACE[a[t]]);let s=matchBrackets(a),n=s[0],i=s[1];if(i.length)throw new ExprError('SyntaxError',`The character "${i[0][0]}" shouldn’t be here.`);return n}function rad(e,t=origin){const s=_Mathatan(e.y-t.y,e.x-t.x);return(s+twoPi)%twoPi}function liesOnSegment(e,t){return nearlyEquals(e.p1.x,e.p2.x)?isBetween(t.y,e.p1.y,e.p2.y):isBetween(t.x,e.p1.x,e.p2.x)}function liesOnRay(e,t){return nearlyEquals(e.p1.x,e.p2.x)?0<(t.y-e.p1.y)/(e.p2.y-e.p1.y):0<(t.x-e.p1.x)/(e.p2.x-e.p1.x)}function lineLineIntersection(e,t){const a=e.p1.x-e.p2.x,s=e.p1.y-e.p2.y,n=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,o=a*i-s*n;if(nearlyEquals(o,0))return[];const r=e.p1.x*e.p2.y-e.p1.y*e.p2.x,l=t.p1.x*t.p2.y-t.p1.y*t.p2.x;return[new Point((r*n-a*l)/o,(r*i-s*l)/o)]}function circleCircleIntersection(e,t){const s=Point.distance(e.c,t.c);if(s>e.r+t.r)return[];if(s<_Mathabs(e.r-t.r))return[];if(nearlyEquals(s,0)&&nearlyEquals(e.r,t.r))return[];if(nearlyEquals(s,e.r+t.r))return[new Line(e.c,t.c).midpoint];const n=(square(e.r)-square(t.r)+square(s))/(2*s),a=_Mathsqrt(square(e.r)-square(n)),i=(t.c.x-e.c.x)*n/s+(t.c.y-e.c.y)*a/s+e.c.x,o=(t.c.y-e.c.y)*n/s-(t.c.x-e.c.x)*a/s+e.c.y,r=(t.c.x-e.c.x)*n/s-(t.c.y-e.c.y)*a/s+e.c.x,l=(t.c.y-e.c.y)*n/s+(t.c.x-e.c.x)*a/s+e.c.y;return[new Point(i,o),new Point(r,l)]}function lineCircleIntersection(){return[]}function intersections(...e){if(2>e.length)return[];if(2<e.length)return flatten(subsets(e,2).map((t)=>intersections(...t)));const t=e[0],a=e[1];if(t instanceof Polygon||t instanceof Rectangle)return intersections(a,...t.edges);if(a instanceof Polygon||t instanceof Rectangle)return intersections(t,...a.edges);let s=[];return t instanceof Line&&a instanceof Line?s=lineLineIntersection(t,a):t instanceof Line&&a instanceof Circle?s=lineCircleIntersection(t,a):t instanceof Circle&&a instanceof Line?s=lineCircleIntersection(a,t):t instanceof Circle&&a instanceof Circle&&(s=circleCircleIntersection(t,a)),t instanceof Segment&&(s=s.filter((e)=>liesOnSegment(t,e))),a instanceof Segment&&(s=s.filter((e)=>liesOnSegment(a,e))),t instanceof Ray&&(s=s.filter((e)=>liesOnRay(t,e))),a instanceof Ray&&(s=s.filter((e)=>liesOnRay(a,e))),s}function shuffle(e){e=e.slice(0);for(let a,s=e.length-1;0<s;--s){a=_Mathfloor(Math.random()*(s+1));var t=[e[a],e[s]];e[s]=t[0],e[a]=t[1]}return e}function intArray(e){let t=[];for(let a=0;a<e;++a)t.push(a);return shuffle(t)}function uniform(e=0,t=1){return e+(t-e)*Math.random()}function animate(e,t){function a(){i&&(!t||n<=t)&&window.requestAnimationFrame(a),n=Date.now()-s,e(t?_Mathmin(1,n/t):n),t&&n>=t&&o.resolve()}if(0===t)return void e();let s=Date.now(),n=0,i=!0,o=defer(),r=o.promise.then.bind(o.promise);return a(),{cancel:function(){i=!1,o.reject()},then:r}}function easeIn(e,a,n){return'quad'===e?a*a:'cubic'===e?a*a*a:'quart'===e?a*a*a*a:'quint'===e?a*a*a*a*a:'circ'===e?1-_Mathsqrt(1-a*a):'sine'===e?1-_Mathcos(a*_MathPI/2):'exp'===e?0>=a?0:_Mathpow(2,10*(a-1)):'back'===e?(n||(n=1.70158),a*a*((n+1)*a-n)):'elastic'===e?(n||(n=.3),-_Mathpow(2,10*(a-1))*_Mathsin((2*(a-1)/n-.5)*_MathPI)):'swing'===e?.5-_Mathcos(a*_MathPI)/2:'spring'===e?1-_Mathcos(4.5*a*_MathPI)*Math.exp(6*-a):'bounce'===e?a<1/11?1/64-7.5625*(.5/11-a)*(.5/11-a):a<3/11?1/16-7.5625*(2/11-a)*(2/11-a):a<7/11?1/4-7.5625*(5/11-a)*(5/11-a):1-7.5625*(1-a)*(1-a):a}function ease(e,a=0,t=0){return 0===a?0:1===a?1:(e=e.split('-'),'in'===e[1]?easeIn(e[0],a,t):'out'===e[1]?1-easeIn(e[0],1-a,t):.5>=a?easeIn(e[0],2*a,t)/2:1-easeIn(e[0],2*(1-a),t)/2)}function transition(t,a,e=400,s=0,n='ease-in-out'){if(!isReady)return Object.keys(a).forEach((e)=>{let s=a[e];t.css(e,Array.isArray(s)?s[1]:s)}),Promise.resolve();t._data._animation&&t._data._animation.cancel();let i={},o={},r=defer(),l=window.getComputedStyle(t._el);Object.keys(a).forEach(function(e){let t=a[e];o[e]=Array.isArray(t)?t[0]:l.getPropertyValue(e),i[e]=Array.isArray(t)?t[1]:t});let d=i.height;'auto'==i.height&&(i.height=total(t.children.map((e)=>e.outerHeight))+'px');let c=t._el.animate([o,i],{duration:e,delay:s,easing:n,fill:'forwards'});c.onfinish=function(s){t._el&&Object.keys(a).forEach((e)=>{t.css(e,'height'==e?d:i[e])}),r.resolve(s),c.cancel()};let p={then:r.promise.then.bind(r.promise),cancel:function(){return t._el&&Object.keys(a).forEach((e)=>{t.css(e,t.css(e))}),c.cancel()}};return setTimeout(function(){t._data._animation=p}),p}function enter(e,t='fade',a=500,s=0){if(!isReady)return void e.show();delay(function(){e.show()},s);let n;if('fade'===t)n=transition(e,{opacity:[0,1]},a,s);else if('pop'===t){let t=e.transform.replace(/scale\([0-9.]*\)/,'').replace(cssMatrix,'translate($1px,$2px)');transition(e,{opacity:[0,1]},a,s),n=transition(e,{transform:[t+' scale(0.5)',t+' scale(1)']},a,s,'cubic-bezier(0.175, 0.885, 0.32, 1.275)')}else if(t.startsWith('slide')){let i=t.split('-'),o={};if(contains(i,'left')||contains(i,'right')){let e=contains(i,'right')?'50%':'-50%';o.transform=[`translateX(${e})`,'none'],o.opacity=[0,1]}contains(i,'down')&&(o.height=[0,'auto']),n=transition(e,o,a,s)}else if('draw'===t){let t=e.strokeLength+'px';e.css({opacity:1,"stroke-dasharray":t+' '+t}),n=transition(e,{strokeDashoffset:[t,0]},a,s,'linear'),n.then(function(){e.css('stroke-dasharray','')})}return n}function exit(e,t='fade',a=400,s=0){if(!isReady)return void e.hide();if('none'===e.css('display'))return;let n;if('fade'===t)n=transition(e,{opacity:[1,0]},a,s);else if('pop'===t){let t=e.transform.replace(/scale\([0-9\.]*\)/,'');transition(e,{opacity:[1,0]},a,s),n=transition(e,{transform:[t+' scale(1)',t+' scale(0.5)']},a,s,'cubic-bezier(0.68, -0.275, 0.825, 0.115)')}else if(t.startsWith('slide')){let i=t.split('-'),o={};if(contains(i,'left')||contains(i,'right')){let e=contains(i,'right')?'50%':'-50%';o.transform=['none',`translateX(${e})`],o.opacity=[1,0]}contains(i,'up')&&(o.height=0),n=transition(e,o,a,s)}else if('draw'===t){let t=e.strokeLength+'px';e.css('stroke-dasharray',t+' '+t),n=transition(e,{strokeDashoffset:[0,t]},a,s,'linear')}return n.then(function(){e.hide()}),n}function effect(e,t){e.animationEnd(function(){e.removeClass('effects-'+t)}),e.addClass('effects-'+t)}function redraw(){document.body.offsetHeight}function resize(e=null){e?(e({width,height}),browserEvents.on('resize',e)):doResize()}function afterLoad(){if(!loaded){loaded=!0;for(let e of loadQueue)e();setTimeout(resize)}}function ready(e){loaded?e():loadQueue.push(e)}function cssTimeToNumber(e){let t=/^([\-\+]?[0-9]+(\.[0-9]+)?)(m?s)$/,a=t.exec(e.trim());return null===a?null:+a[1]*('s'===a[3]?1e3:1)}function addCSS(e){let t=document.createElement('style');t.type='text/css',t.innerHTML=e,document.head.appendChild(t)}function addCSSRule(e,t){let a=document.styleSheets[document.styleSheets.length-1],s=a.cssRules.length-1;a.insertRule?a.insertRule(e+'{'+t+'}',s):a.addRule(e,t,s)}function getCookies(){let e=document.cookie.split(';'),t={};for(let a,s=0,i=e.length;s<i;++s)a=e[s].split('='),a[0]=a[0].replace(/^\s+|\s+$/,''),t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]);return t}function getCookie(e){let t=document.cookie.match(new RegExp(`(^|;) ?${e}=([^;]*)(;|$)`));return t?t[2]:null}function setCookie(e,t,a=31536000){document.cookie=e+'='+t+';path=/;max-age='+a}function deleteCookie(e){setCookie(e,'',-1)}function setStorage(e,t){let a=(e||'').split('.'),s=JSON.parse(window.localStorage.getItem(STORAGE_KEY))||{},n=s;for(let s=0;s<a.length-1;++s)null==n[a[s]]&&(n[a[s]]={}),n=n[a[s]];n[a[a.length-1]]=t,window.localStorage.setItem(STORAGE_KEY,JSON.stringify(s))}function getStorage(e){let t=JSON.parse(window.localStorage.getItem(STORAGE_KEY))||{};if(!e)return t;const a=(e||'').split('.'),s=a.pop();for(let s of a){if(!(s in t))return null;t=t[s]}return t[s]}function deleteStorage(e){e?setStorage(e,null):window.localStorage.setItem(STORAGE_KEY,'')}function activeInput(){let e=document.activeElement;return e===document.body?void 0:$(e)}function onKey(t,a){t=words(t).map((e)=>keyCodes[e]||e),document.addEventListener('keydown',function(s){let e=activeInput();e&&e.is('input, textarea, [contenteditable]')||0<=t.indexOf(s.keyCode)&&a(s)})}function replaceSvgImports(){if(polyfill){let e=Array.from(document.querySelectorAll('svg > use'));e.forEach(function(e){let t=e.getAttribute('xlink:href'),a=t.split('#'),s=a[0],n=a[1];if(!s.length)return;let i=e.parentNode;i.removeChild(e),s in requests||(requests[s]=get(s));let o=requests[s];o.then(function(e){let t=document.implementation.createHTMLDocument('');t.documentElement.innerHTML=e;let a=t.getElementById(n),s=a.cloneNode(!0),o=document.createDocumentFragment();for(;s.childNodes.length;)o.appendChild(s.firstChild);i.appendChild(o)})})}}function pointerPosition(t){if('touches'in t){let e=t.targetTouches.length?t.targetTouches:t.changedTouches;return new Point(e[0].clientX,e[0].clientY)}return new Point(t.clientX,t.clientY)}function svgPointerPosn(e,t){let a=pointerPosition(e);return a.transform(t.inverseTransformMatrix)}function canvasPointerPosition(e,t){const a=pointerPosition(e),s=t.bounds,n=(a.x-s.left)*t._el.width/s.width,i=(a.y-s.top)*t._el.height/s.height;return new Point(n,i)}function makeClickEvent(t){if(t._events._click)return;if(t._events._click=!0,!navigator.userAgent.match(/iP(ad|hone|od)/g))return void t._el.addEventListener('click',function(a){t.trigger('click',a)});let a;t._el.addEventListener('touchstart',function(t){1==t.touches.length&&(a=pointerPosition(t))}),t._el.addEventListener('touchend',function(s){if(a){let e=pointerPosition(s);5>_Mathabs(e.x-a.x)&&5>_Mathabs(e.y-a.y)&&t.trigger('click',s),a=null}}),t._el.addEventListener('touchcancel',function(){a=null})}function makeClickOutsideEvent(t){t._events._clickOutside||(t._events._clickOutside=!0,$body.on('click',function(a){$(a.target).hasParent(t)||t.trigger('clickOutside')}))}function slide(t,a){function e(t){t.preventDefault();t.handled||t.touches&&1<t.touches.length||(t.handled=!0,'move'in a&&d.on('pointermove',s),d.on('pointerstop',n),r=l=o(t),'start'in a&&a.start(r))}function s(t){t.preventDefault();i||(i=!0,window.requestAnimationFrame(function(){if(i){const e=o(t);a.move(e,r,l),l=e,i=!1}}))}function n(t){t.preventDefault();t.touches&&0<t.touches.length||(i=!1,'move'in a&&d.off('pointermove',s),d.off('pointerstop',n),'end'in a&&a.end(l,r))}let i=!1,o=pointerPosition;if('SVG'===t.tagName)o=(a)=>svgPointerPosn(a,t);else if('CANVAS'===t.tagName)o=(a)=>canvasPointerPosition(a,t);else if(t instanceof SVGElement){const a=t.parents('svg')[0];o=(t)=>svgPointerPosn(t,a)}let r,l,d=a.justInside?t:$body;'auto'==t.css('touch-action')&&t.css('touch-action','none'),t.on('pointerdown',e),a.justInside&&t.on('mouseleave',n)}function makeScrollEvents(e){function t(){let a=e.scrollTop;return a==o?void(i=!1):void(o=a,e.trigger('scroll',{top:o}),window.requestAnimationFrame(t))}function a(){i||window.requestAnimationFrame(t),i=!0}function s(){window.addEventListener('touchmove',a),window.addEventListener('touchend',n)}function n(){window.removeEventListener('touchmove',a),window.removeEventListener('touchend',n)}if(e._data._scrollEvents)return;e._data._scrollEvents=!0;let i=!1,o=null,r=e instanceof WindowElement?window:e._el;r.addEventListener('scroll',a),e._el.addEventListener('touchstart',function(t){t.handled||s()})}function makeHoverEvent(e,t){let a=null,s=!1;e.on('mouseover',()=>{clearTimeout(a),a=delay(()=>{s||(t.enter(),s=!0)},t.delay)}),e.on('mouseout',()=>{clearTimeout(a),a=delay(()=>{s&&(t.exit&&t.exit(),s=!1)},t.delay)});const n=t.$clickTarget||e;n.on('click',()=>{s?(t.exit&&t.exit(),s=!1):(t.enter(),s=!0)}),e.on('clickOutside',()=>{s&&(t.exit&&t.exit(),s=!1)})}function intersectionCallback(t){for(let a of t){const e=a.isIntersecting?'enterViewport':'exitViewport';setTimeout(()=>$(a.target).trigger(e))}}function makeIntersectionEvents(e){if(!e._data.intersectionEvents){if(e._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;return void $body.on('scroll',()=>{let a=e.isInViewport;t&&!a?(e.trigger('exitViewport'),t=!1):a&&!t&&(e.trigger('enterViewport'),t=!0)})}observer||(observer=new IntersectionObserver(intersectionCallback)),observer.observe(e._el)}}function checkInside(e,t){let a=pointerPosition(e),s=document.elementFromPoint(a.x,a.y);return isOneOf(t._el,s,s.parentNode,s.parentNode.parentNode)}function makePointerPositionEvents(t){if(t._data._pointerEvents)return;t._data._pointerEvents=!0;let e=t.parent,a=null;e.on('pointerend',function(){a=null}),e.on('pointermove',function(s){let e=a;a=checkInside(s,t),null!=e&&a&&!e&&t.trigger('pointerenter',s),!a&&e&&t.trigger('pointerleave',s)})}function makeMouseEvent(t,a){a._events['_'+t]||(a._events['_'+t]=!0,a._el.addEventListener(t,function(s){touchEnabled||a.trigger(t,s)}))}function createEvent(e,t,a,s){t in e._events?0>e._events[t].indexOf(a)&&e._events[t].push(a):e._events[t]=[a],t in aliases?e.on(aliases[t],a,s):t in customEvents?customEvents[t](e,a):e._el.addEventListener(t,a,s)}function removeEvent(e,t,a,s){t in e._events&&(e._events[t]=without(e._events[t],a)),t in aliases?e.off(aliases[t],a,s):t in customEvents||e._el.removeEventListener(t,a,s)}function observable(e={}){function t(t,a){s[t]=a,t in e||Object.defineProperty(e,t,{get:()=>s[t],set(a){s[t]=a,e.update()}})}let a=[],s={},i=1,n=ALPHABETH.split('').map((e)=>'_'+e);for(let a of Object.keys(e))t(a,e[a]);return e.update=function(){for(let e of a)e(s)},e.watch=function(e,t=!1){a.push(e),t||e(s)},e.set=function(a,n){s[a]===n||(t(a,n),e.update())},e.assign=function(a){for(let e of Object.keys(a))t(e,a[e]);e.update()},e.name=function(){return n.length||(i+=1,n=ALPHABETH.split('').map((e)=>repeat('_',i)+e)),n.pop()},e}function parse(t,e=!1){let a=t.replace(/×/g,'*');e||(a=a.replace(/"/g,'"').replace(/\$\{([^\}]+)\}/g,(e,t)=>`" + (${t}) + "`),a='"'+a+'"');try{return new Function('_vars',`try {
      with(_vars) { return ${a} }
    } catch(_error) {
      if (!(_error instanceof ReferenceError)) console.warn(_error);
      return "";
    }`)}catch(a){return console.warn('WHILE PARSING: ',t,'\n',a),function(){return''}}}function makeTemplate(e,t,a,s=a){if(0>a[t].indexOf('${'))return;let n=parse(a[t]);e.watch(()=>{s[t]=n(e)}),s[t]=n(e)}function bindObservable(e,t,a=!0){for(let s of e.attributes){let a=s.name.match(/^x-/)?document.createAttribute(s.name.replace(/^x-/,'')):s;makeTemplate(t,'value',s,a),a!==s&&e._el.setAttributeNode(a)}if(e.children.length)for(let s of e.childNodes)'TEXT'===s.tagName?makeTemplate(t,'text',s):a&&bindObservable(s,t);else e.html.trim()&&makeTemplate(t,'html',e)}function $(e,t=null){const a=t?t._el:document.documentElement,s='string'==typeof e?a.querySelector(e):e;if(!s)return null;if(s.$el)return s.$el;if(isOneOf(s,window,document.body,document.documentElement))return new WindowElement(s);const n=(s.tagName||'').toLowerCase();return 0<=svgTags.indexOf(n)?new SVGElement(s):0<=formTags.indexOf(n)?new FormElement(s):'canvas'===n?new CanvasElement(s):new Element(s)}function $$(e,t=null){const a=t?t._el:document.documentElement;let s=a.querySelectorAll(e);return Array.from(s,(e)=>$(e))}function $N(e,s={},a=null){let n=0>svgTags.indexOf(e)?document.createElement(e):document.createElementNS('http://www.w3.org/2000/svg',e);for(let t in s)'id'===t?n.id=s.id:'html'===t?n.innerHTML=s.html:n.setAttribute(t,s[t]);let t=$(n);return a&&a.append(t),t}function $$N(e){return $N('div',{html:e}).children}function toQueryString(e){let t=[];for(let a in e){let s=e[a];if(a=encodeURIComponent(a),null==s)return void t.push(a);s=Array.isArray(s)?s.join(','):''+s,s=s.replace(/(\r)?\n/g,'\r\n'),s=encodeURIComponent(s),s=s.replace(/%20/g,'+'),t.push(a+'='+s)}return t.join('&')}function fetch(e,t,a=null,s={async:!0,cache:!0}){let n=new XMLHttpRequest,i=defer(),o='';return n.onreadystatechange=function(){if(!(3>=n.readyState)){let e=n.status;200<=e&&300>e||304===e?i.resolve(n.responseText):i.reject(n)}},'GET'===e?(t+=0<=t.indexOf('?')?'&xhr=1':'?xhr=1',!s.cache&&(t+='_cachebust='+Date.now()),a&&(t+=toQueryString(a)+'&'),n.open(e,t,s.async,s.user,s.password)):'POST'==e&&(n.open(e,t,s.async,s.user,s.password),n.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),n.setRequestHeader('X-CSRF-Token',window.csrfToken||''),o=isString(a)?'?'+a:Object.keys(a).map((e)=>encodeURIComponent(e)+'='+encodeURIComponent(a[e])).join('&')),n.setRequestHeader('x-requested-with','XMLHttpRequest'),n.send(o),i.promise}function get(e,t=null){return fetch('GET',e,t)}function post(e,t=null){return fetch('POST',e,t)}function sendLogs(){if(!1!==navigator.onLine){for(let e of Object.keys(POST_DATA))beacon(e,{data:JSON.stringify(POST_DATA[e])});POST_DATA={}}}function deferredPost(e,t){deepExtend(POST_DATA,{[e]:t}),doDeferredPost()}function beacon(e,t=null){fetch('POST',e,t)}function pad2(e){return 1===e.length?'0'+e:e}function interpolate(e,t,a){return a=clamp(a,0,1),e instanceof Colour||(e=Colour.fromHex(e)),t instanceof Colour||(t=Colour.fromHex(t)),new Colour(a*e.r+(1-a)*t.r,a*e.g+(1-a)*t.g,a*e.b+(1-a)*t.b,a*e.a+(1-a)*t.a)}function getColourAt(e,t){t=clamp(t,0,.9999);let a=_Mathfloor(t*(e.length-1)),s=t*(e.length-1)-a;return interpolate(e[a+1],e[a],s)}function getViewParams(e,t){let a=t.regex.exec(e);return a?(a.shift(),zip(t.params,a)):null}function onLinkClick(t){if(t.metaKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;let e=t.target;for(;e&&'A'!==e.nodeName;)e=e.parentNode;if(e&&'A'===e.nodeName&&!e.target&&e.origin===window.location.origin&&!(e.hasAttribute('download')||'external'===e.getAttribute('rel'))){let a=e.getAttribute('href');if(!(a&&-1<a.indexOf('mailto:'))){let a=this.goTo(e.pathname+e.search,e.hash);a&&t.preventDefault()}}}function renderView(e,t,a,s){e.$viewport.css('opacity',0),setTimeout(()=>{e.$viewport.removeChildren(),$body.scrollTop=0,e.$viewport.html=a,Browser.resize(),Browser.replaceSvgImports(),e.$viewport.css({opacity:1,"pointer-events":'all'}),document.title=e.$viewport.$('title').text,e.initialise(e.$viewport,s),t.enter&&t.enter(e.$viewport,s),e.trigger('afterChange')},350)}function loadView(e,t,a={},s=''){e.$viewport.css({opacity:.4,"pointer-events":'none'});let n=run(t.template,a)||get(s);n.then?n.then((s)=>renderView(e,t,s,a)):renderView(e,t,n,a)}function applyTemplate(e,t){const a=Array.from(e.childNodes);if(t.template)e.innerHTML=t.template;else if(t.templateId){let a=document.querySelector(t.templateId);if(!a)throw new Error('Template not found:',t.templateId);for(;e.firstChild;)e.removeChild(e.firstChild);let s=document.importNode(a.content,!0);e.appendChild(s)}if(a.length){const t=e.querySelector('slot:not([name])');for(let s of a){let a=s.getAttribute?s.getAttribute('slot'):null,n=a?e.querySelector(`slot[name="${a}"]`):t;n&&n.parentNode.insertBefore(s,n)}for(let t of e.querySelectorAll('slot'))t.parentNode.removeChild(t)}}function customElementChildren(e){const t=[];for(let a of e.children)a.tagName.startsWith('X-')?t.push(a):t.push(...customElementChildren(a));return t}function registerElement(e,t,a={}){class s extends CustomHTMLElement{constructor(){super(),this.$el=new t(this),this._wasConnected=!1}static get observedAttributes(){return a.attributes||[]}}customElementOptions.set(e.toUpperCase(),a),window.customElements.define(e,s)}function write(e){let t=window.getSelection();if(t.rangeCount){let a=t.getRangeAt(0);a.deleteContents(),a.insertNode(e._el);let s=e.parent;if(isOneOf(s.tagName,'MO','MI','MN')){let t=e.next;s.insertAfter(e),t&&e.insertAfter(t)}let n=document.createRange();e.children.length?n.setStart(e.children[0]._el,0):n.setStart(e._el,e.text.length),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}}function keydown(t,e){if(isOneOf(t.keyCode,16,17,18,20,37,38,39,40))return;if(t.metaKey&&isOneOf(t.keyCode,88,67,82))return;if(t.metaKey&&86===t.keyCode)return void t.preventDefault();if(isOneOf(t.keyCode,8,46))return void setTimeout(e);t.preventDefault();let a=(t.key||String.fromCharCode(t.which)).toLowerCase();a=a.replace('*','\xD7').replace('/','\xF7').replace('-','\u2013'),'abcdefghijklmnopqrstuvwxyz'.includes(a)&&write($N('mi',{html:a})),'0123456789'.includes(a)&&write($N('mn',{html:a})),'+\u2013\xB1\xD7\xF7<>\u2264\u2265='.includes(a)&&write($N('mo',{html:a})),'([{|'.includes(a)&&write($N('mfenced',{type:a,html:'<mrow class="empty"><br></mrow>'})),'%!'.includes(a)&&write($N('span',{html:a})),'^'===a&&write($N('msup',{html:'<mrow><br></mrow>'})),e()}function keyclick(e,t){'frac'===e?write($N('mfrac',{html:'<mrow class="empty"><br></mrow><mrow class="empty"><br></mrow>'})):'sqrt'===e?write($N('msqrt',{html:'<mrow class="empty"><br></mrow>'})):'square'===e?write($N('msup',{html:'<mrow><mn>2</mn></mrow>'})):'brackets'===e?write($N('mfenced',{html:'<mrow class="empty"><br></mrow>',type:'('})):write($N('mo',{html:e}));t()}function clean$1(e){for(let t of e.children)clean$1(t);'MROW'===e.tagName?e.children.filter((e)=>'BR'!==e.tagName).length?(e.removeClass('empty'),e.children.filter((e)=>'BR'===e.tagName).forEach((e)=>e.remove())):(e.html='<br>',e.addClass('empty')):'MFRAC'===e.tagName?1===e.children.length&&e.replace(...e.children[0].children):isOneOf(e.tagName,'MN','MI','MO','MS')&&!e.text&&e.remove()}function toString$1(e){if('TEXT'===e.tagName)return e.text;let t=e.childNodes;return'MFENCED'===e.tagName?'('+toString$1(t[0])+')':'MSUP'===e.tagName?'^('+toString$1(t[0])+')':'MFRAC'===e.tagName?toString$1(t[0])+'/'+toString$1(t[1]):'MSQRT'===e.tagName?'sqrt('+toString$1(t[0])+')':t.map((e)=>toString$1(e)).join('')}function validate(e,t,a,s){if(!e.text.trim())return{error:null};if(e.$('.empty'))return{error:'Fill in all empty placeholders in the expression.'};let n;try{n=new Expression(toString$1(e))}catch(e){return{error:(MESSAGES[e.name]||'')+e.message}}let i=n.variables.filter((e)=>!t.includes(e));if(t.length&&i.length){let e=autocorrect(i[0],t);return e?{error:`Did you mean “${e}” instead of “${i[0]}”?`}:{error:`There shouldn’t be a variable called “${i[0]}”.`}}let o=n.functions.filter((e)=>!a.includes(e));if(a.length&&o.length)return{error:`This expression should not contain ${FN_NAMES[o[0]]}.`};if(s){let e=s(n)||{};if(e.error)return!0===e.error&&(e.error='This is not correct.'),{error:e.error};if(e.final)return{expr:n,final:!0}}return{expr:n}}function drawArc(e,t,a,s=!0){const n=t.x*(a.y-e.y)+e.x*(t.y-a.y)+a.x*(e.y-t.y),i=s&&0<n?1:0,o=s||0>n?1:0,r=Point.distance(t,e);return[e.x,e.y+'A'+r,r,0,i,o,a.x,a.y].join(',')}function angleSize(e,t){if(t.hasAttr('size'))return+t.attr('size');let a=40*(1-e.size/_MathPI/3);return e.isRight&&(a*=.6),a}function drawAngle(e,t){let s=e.a;const a=e.b;let n=e.c;const i=t.hasClass('fill'),o=t.hasAttr('sweep'),r=angleSize(e,t),l=Point.difference(s,a).normal,c=Point.difference(n,a).normal;s=Point.sum(a,l.scale(r)),n=Point.sum(a,c.scale(r));let h=i?`M${a.x},${a.y}L`:'M';if(e.isRight){const e=Point.sum(s,c.scale(r));h+=`${s.x},${s.y}L${e.x},${e.y}L${n.x},${n.y}`}else h+=drawArc(s,a,n,o);return i&&(h+='Z'),h}function drawPath(...e){return'M'+e.map((e)=>e.x+','+e.y).join('L')}function drawLineMark(e,t){const a=e.perpendicularVector.scale(6),s=e.normalVector.scale(3),n=e.midpoint;return'bar'===t?drawPath(n.add(a),n.add(a.inverse)):'bar2'===t?drawPath(n.add(s).add(a),n.add(s).add(a.inverse))+drawPath(n.add(s.inverse).add(a),n.add(s.inverse).add(a.inverse)):'arrow'===t?drawPath(n.add(s.inverse).add(a),n.add(s),n.add(s.inverse).add(a.inverse)):'arrow2'===t?drawPath(n.add(s.scale(-2)).add(a),n,n.add(s.scale(-2)).add(a.inverse))+drawPath(n.add(a),n.add(s.scale(2)),n.add(a.inverse)):void 0}function draw(e,t,a){if(e instanceof Angle)return drawAngle(e,t);if(e instanceof Segment){if(e.p1.equals(e.p2))return'';let a=drawPath(e.p1,e.p2);return t&&t.hasAttr('mark')&&(a+=drawLineMark(e,t.attr('mark'))),a}if(e instanceof Ray){const t=intersections(e,a.box)[0];return t?drawPath(e.p1,t):''}if(e instanceof Line){const s=intersections(e,a.box);if(2>s.length)return'';let n=drawPath(s[0],s[1]);return t&&t.hasAttr('mark')&&(n+=drawLineMark(e,t.attr('mark'))),n}return e instanceof Circle?`M ${e.c.x-e.r},${e.c.y} a ${e.r},${e.r} 0 1,0 ${2*e.r},0 a ${e.r},${e.r} 0 1,0 ${-2*e.r},0`:e instanceof Arc?'M'+drawArc(e.start,e.c,e.end):e instanceof Polyline?drawPath(...e.points):e instanceof Polygon?drawPath(...e.points)+'Z':e instanceof Rectangle?`M${e.p.x},${e.p.y}L${e.p.x+e.w},${e.p.y}L${e.p.x+e.w},${e.p.y+e.h}L${e.p.x},${e.p.y+e.h}Z`:void 0}function makeLabel(e,t,a){const s=e.hasClass('fill')||e.hasClass('move'),n=a||e.attr('label-colour');return $N('text',{target:e.attr('target')||'',class:e.attr('class')||'',fill:n||e.css(s?'fill':'stroke')},t.$labels)}function labelOverlap(e,t,a,s){let n=new Rectangle(new Point(-10,-20),20,23).rotate(a),i=t.paths.filter((t)=>t.val&&t.val!==e);for(let o of s)if(i.every((e)=>!intersections(n.translate(o),e.val).length))return o;return s[0]}function labelPosn(e,t,a){if(e instanceof Line){let s=e.perpendicularVector,n=e.angle;0<=s.y&&(s=s.scale(-1),n+=_MathPI);let i=[];for(let t of[.5,.35,.65])for(let a of[-15,5])i.push(e.at(t).add(s.scale(a)));let o=labelOverlap(e,a,n,i);return t.hasAttr('mark')&&(o=o.add(e.normalVector.scale(12))),`translate(${o.x}px, ${o.y}px) rotate(${n}rad)`}if(e instanceof Angle){const a=angleSize(e,t)+8,s=e.b.add(e.bisector.normalVector.scale(a+5));return`translate(${s.x}px, ${s.y+3}px)`}if(e instanceof Point){const s=t.hasClass('move')?10:8;let n=[e.shift(s,-s),e.shift(-s,-s),e.shift(s,10+s),e.shift(-s,10+s)],i=labelOverlap(e,a,0,n);return`translate(${i.x}px, ${i.y}px)`}if(e instanceof Polygon){const t=e.centroid;return`translate(${t.x}px, ${t.y+5}px)`}return e instanceof Circle?`translate(${e.c.x}px, ${e.c.y+5}px)`:''}function getToolTransform(e,t,a,s){return`translate(${e.x}px, ${e.y-t}px) scale(${s/100}) rotate(${a}rad)`}function openLightbox(e,t,a){isOpen=!0,$activeImg=e,$lightbox.show(),$lightboxImg.show();let n=e.bounds,i=$lightboxImg.bounds,o=n.left+n.width/2-i.left-i.width/2,r=n.top+n.height/2-i.top-i.height/2,l=_Mathmax(n.width/i.width,n.height/i.height);transform={x:o,y:r,s:l},$lightboxImg.css('background-image',`url(${a}), url(${t})`),$lightboxImg.transform=`translate(${o}px, ${r}px) scale(${l})`,Browser.redraw(),$lightboxImg.addClass('transitions'),Browser.redraw(),e.css('visibility','hidden'),$lightbox.addClass('on'),$lightboxImg.transform='scale(1) translate(0,0)'}function closeLightbox(){isOpen&&(isOpen=!1,$lightbox.removeClass('on'),$lightboxImg.transform=`translate(${transform.x}px, ${transform.y}px) scale(${transform.s})`,setTimeout(function(){$activeImg.css('visibility','visible'),$lightbox.css('display','none'),$lightboxImg.transform='none',$lightboxImg.removeClass('transitions')},400))}function draw$1(e,t,a,s){let n;if(.999<=a)n=`<path fill="${s}" stroke="none" d="M ${t},0 `+`C ${t/2},0,0,${t/2},0,${t}  s ${t/2},${t},${t},${t} `+`s ${t}-${t/2},${t}-${t}     S ${1.5*t},0,${t},0 z `+`M ${44.6*t/50},${76.1*t/50} L ${19.2*t/50},${48.8*t/50} `+`l ${4*t/50}-${4.2*t/50}     l ${19.8*t/50},${11.9*t/50} `+`l ${34.2*t/50}-${32.6*t/50} l ${3.5*t/50},${3.5*t/50} `+`L ${44.6*t/50},${76.1*t/50} z"/>`;else{let e=t+t*_Mathsin(2*a*_MathPI),i=t-t*_Mathcos(2*a*_MathPI),o=.5<a?1:0;n=`<circle cx="${t}" cy="${t}" r="${t}" stroke="${s}" stroke-width="1" fill="transparent"/>`+`<path d="M ${t} ${t} L ${t} 0 A ${t} ${t} 0 ${o} 1 ${e} ${i} Z" fill="${s}"/>`}e.html='<g transform="translate(1 1)">'+n+'</g>'}function connect(e,t,a,s){let n=new Point(e.left-15,e.top+a-15),i=new Rectangle(n,e.width+30,e.height+30),o=i.project({x:t.left+t.width/2,y:t.top+t.height/2+s}),r=new Point(t.left-15,t.top+s-15),l=new Rectangle(r,t.width+30,t.height+30),d=l.project({x:e.left+e.width/2,y:e.top+e.height/2+a});return[o,d]}function distance(e,t){return _Mathabs(e[0]-t[0])+_Mathabs(e[1]-t[1])}function hideTooltip(){show=null,$tooltip.removeClass('active')}function showTooltip(e,t,a){$tooltip.text=t,$tooltip.setAttr('class','tooltip '+a);let s=e.bounds,n='left'===a?s.left-$tooltip.width-8:'right'===a?s.right+8:s.left+s.width/2-$tooltip.width/2,i='top'===a?s.top-$tooltip.height-8:'bottom'===a?s.bottom+8:s.top+s.height/2-$tooltip.height/2;$tooltip.css({left:n+'px',top:i+'px '}),$tooltip.addClass('active')}function confetti(e=2e3,t=150){$confetti||($confetti=$N('canvas',{style},$body)),$confetti.setAttr('width',Browser.width),$confetti.setAttr('height',Browser.height),$confetti.show();const a=$confetti.getContext(),s=tabulate((e)=>new Particle(e),t);let n=animate((i)=>{a.clearRect(0,0,Browser.width,Browser.height);let t=0;for(let n of s)n.draw(a),n.update(i,i<e),n.y<Browser.height&&(t+=1);t||(n.cancel(),$confetti.hide())})}function parseEmoji(e){return e.replace(/:(\w+):/g,function(e,t){return`<img class="emoji" width=20 height=20 src="/images/emoji/${t}.png"/>`})}function meanEasterEgg(){CORRECT=loop(['I guess that wasn\u2019t terrible.','Meh.','That was just lucky!','Don\u2019t get too full of yourself.']),INCORRECT=loop(['You suck\u2026 :1f648:','Wrong again! :1f9df:','Nope :1f4a9:','Did you hit your head on something?','Do you ever get stuff right?','You\u2019re terrible!!'])}function createBubble(e,t,a){const s=$N('div',{class:a},t);let n=e.text||e.question||'';e.source&&(n+=`<div class="source">${e.source}</div>`);const i=e.img?'gif':e.question?'question':e.video?'video':'';let o=$N('div',{class:'bubble '+i,html:n},s);return e.img&&o.css('background-image',`url(${e.img})`),e.video&&$N('iframe',{src:e.video,allowfullscreen:!0},o),s}function getOrCreateMethodChain(e,t){let a=instances.filter((a)=>a.context==e&&a.methodName==t)[0];return a||(a=new MethodChain(e,t),instances.push(a)),a}function createFieldsObj(e,t,a=void 0,s=void 0,n=void 0,i=void 0){if('function'==typeof s){const o=a.get('buildHitTask');return{buildHitTask:(a)=>{a.set(e,null,!0),a.set(t,null,!0),s(a,n,i),o(a)}}}return assign({},e,t)}function deferUntilPluginsLoaded(e,t){const a=e.get('trackingId'),s=queueMap[a]=queueMap[a]||{},n=()=>{clearTimeout(s.timeout),s.send&&MethodChain.remove(e,'send',s.send),delete queueMap[a],s.queue.forEach((e)=>e())};clearTimeout(s.timeout),s.timeout=setTimeout(n,0),s.queue=s.queue||[],s.queue.push(t),s.send||(s.send=(e)=>(...t)=>{n(),e(...t)},MethodChain.add(e,'send',s.send))}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function isObject$1(e){return'object'==typeof e&&null!==e}function now(){return+new Date}function provide(e,t){const a=window.GoogleAnalyticsObject||'ga';window[a]=window[a]||function(...e){(window[a].q=window[a].q||[]).push(e)},window.gaDevIds=window.gaDevIds||[],0>window.gaDevIds.indexOf(DEV_ID)&&window.gaDevIds.push(DEV_ID),window[a]('provide',e,t),window.gaplugins=window.gaplugins||{},window.gaplugins[capitalize(e)]=t}function initStorageListener(){window.addEventListener('storage',storageListener),isListening=!0}function removeStorageListener(){window.removeEventListener('storage',storageListener),isListening=!1}function storageListener(e){const t=instances$1[e.key];if(t){const a=assign({},t.defaults_,parse$1(e.oldValue)),s=assign({},t.defaults_,parse$1(e.newValue));t.cache_=s,t.emit('externalSet',s,a)}}function parse$1(e){let t={};if(e)try{t=JSON.parse(e)}catch(e){}return t}function trackUsage(e,t){trackVersion(e),trackPlugin(e,t)}function convertHexToBin(e){return parseInt(e||'0',16).toString(2)}function convertBinToHex(e){return parseInt(e||'0',2).toString(16)}function padZeros(e,t){if(e.length<t)for(let a=t-e.length;a;)e='0'+e,a--;return e}function flipBitOn(e,t){return e.substr(0,t)+1+e.substr(t+1)}function trackPlugin(e,t){const a=e.get('&'+USAGE_PARAM);let s=padZeros(convertHexToBin(a),PLUGIN_COUNT);s=flipBitOn(s,PLUGIN_COUNT-t),e.set('&'+USAGE_PARAM,convertBinToHex(s))}function trackVersion(e){e.set('&'+VERSION_PARAM,VERSION)}var _Mathfloor=Math.floor,_Mathatan=Math.atan2,_Mathsin=Math.sin,_Mathcos=Math.cos,_Mathsqrt=Math.sqrt,_MathPI=Math.PI,_Mathlog=Math.log,_Mathmin=Math.min,_Mathmax=Math.max,_Mathround=Math.round,_Mathpow=Math.pow,_Mathabs=Math.abs;const tolerance=1e-6,ONES=['','one','two','three','four','five','six','seven','eight','nine','ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'],TENS=['','','twenty','thirty','fourty','fifty','sixty','seventy','eighty','ninety'],MULTIPLIERS=['','thousand','million','billion','trillion','quadrillion','quintillion','sextillion'];class Evented{constructor({split:e=' ',lowercase:t=!1}={}){this._options={split:e,lowercase:t},this._events={}}on(t,a){for(let s of process(t,this._options))s in this._events||(this._events[s]=[]),this._events[s].push(a)}one(e,t){function a(...n){s.off(e,a),t(...n)}let s=this;this.on(e,a)}off(t,e){for(let a of process(t,this._options))a in this._events&&(this._events[a]=this._events[a].filter((t)=>t!==e))}trigger(t,...e){for(let a of process(t,this._options))a in this._events&&this._events[a].forEach(function(t){t.apply(this,e)})}}class ExprError extends Error{constructor(e,t){super(t),this.name=e}}let HAS_GENERATED_RULES=!1,REWRITE_RULES=[['x^0','1'],['0*x','0'],['x/x','1'],['x^1','x'],['x-(-y)','x+y'],['sqrt(x)','x^0.5'],['x-y','x+(-y)'],['-V','(-1) * V'],['x/(y^z)','x*(y^(-z))'],['x/y','x*(y^(-1))'],['(x*y)^z','x^z*y^z'],['a^(b+c)','a^b*a^c'],['(a^b)^c','a^(b*c)'],['log(a^b)','b*log(a)'],['log(a*b)','log(a)+log(b)'],['(a+b)^2','a^2+2*a*b+b^2'],['(a+b)*(c+d)','a*c+a*d+b*c+b*d'],['(a+b)*c','a*c+b*c'],['x * x','x^2'],['x * x^y','x^(y+1)'],['x^y * x^z','x^(y+z)'],['x+x','2*x'],['x+(-x)','0'],['x*y + x','x*(y+1)'],['x*y + x*z','x*(y+z)'],['(-1) * x','-x'],['x+(-y)','x-y'],['x*(y^(-1))','x/y'],['x*(y^(-z))','x/(y^z)'],['x^(-1)','1/x'],['x^0.5','sqrt(x)'],['x*(y/z)','(x*y)/z'],['x-(y+z)','x-y-z'],['1*x','x'],['0+x','x']];const FN_EVALUATE={"+":(...e)=>e.reduce((e,t)=>e+t,0),"-":(e,t)=>void 0===t?-e:e-t,"*":(...e)=>e.reduce((e,t)=>e*t,1),"/":(e,t)=>e/t,"!":(e)=>factorial(e),"%":(e)=>e/100,"^":(e,t)=>_Mathpow(e,t),log:(e,t)=>void 0===t?_Mathlog(e):_Mathlog(e)/_Mathlog(t),"=":(e,t)=>0==simplify(['-',e,t])},CONSTANTS={pi:_MathPI,e:Math.E},FN_STRINGIFY={"+":(...e)=>e.join(' + '),"-":(e,t)=>void 0===t?'-'+e:e+' - '+t,"±":(e,t)=>void 0===t?'\xB1'+e:e+' \xB1 '+t,"*":(...e)=>e.join('*'),"/":(e,t)=>e+'/'+t,"!":(e)=>e+'!',"%":(e)=>e+'%',abs:(e)=>'|'+e+'|',"^":(e,t)=>e+'^'+t,"=":(e,t)=>e+' = '+t,"<":(e,t)=>e+' < '+t,">":(e,t)=>e+' > '+t,"≤":(e,t)=>e+' \u2264 '+t,"≥":(e,t)=>e+' \u2265 '+t},TOKEN_REGEX=/\b[0-9]+(\.[0-9]*)?\b|\b\.[0-9]+\b|\b\w+\b|\+|-|–|±|\*|×|\/|÷|\^|%|!|\(|\)|\[|\]|\{|\}|\||=|<|>|≤|≥/g,TOKEN_REPLACE={"–":'-',"÷":'/',"×":'*'},BRACKETS={"(":')',"[":']',"{":'}',"|":'|'};class Expression{constructor(e){this.expr=isString(e)?parseString(e):e}toString(){return stringify(this.expr)}get simplified(){return new Expression(simplify(this.expr))}get functions(){return functions(this.expr)}get variables(){return variables(this.expr)}same(e){return same(this.expr,e.expr)}equals(e){return 0==simplify(['-',this.expr,e.expr])}evaluate(e={}){let t=evaluate(this.expr,e);if(!isNumber(t)){let e=[...variables(t),...functions(t)].join(', ');throw new ExprError('EvalError',`This expression contains unknown variables or functions: ${e}.`)}return t}numEquals(e){let t=this.variables;if(difference(t,e.variables).length)return!1;for(let s,a=0;5>a;++a){s={};for(let e of t)s[e]=5*Math.random();let n=evaluate(substitute(this.expr,s)),a=evaluate(substitute(e.expr,s));if(!nearlyEquals(n,a))return!1}return!0}substitute(e){let t={};for(let a of Object.keys(e))t[a]=parseString(''+e[a]);return new Expression(substitute(this.expr,t))}}class Point{constructor(e=0,t=0){this.x=e,this.y=t}get normal(){return this.scale(1/this.length)}get length(){return _Mathsqrt(square(this.x)+square(this.y))}get inverse(){return new Point(-this.x,-this.y)}get flip(){return new Point(this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return Point.distance(this,e.project(this))}clamp(e,t,a,s){return new Point(clamp(this.x,e,t),clamp(this.y,a,s))}transform(e){if(!e)return this;let t=e[0][0]*this.x+e[0][1]*this.y+e[0][2],a=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new Point(t,a)}rotate(e,t=origin){let a=this.x-t.x,s=this.y-t.y,n=_Mathcos(e),i=_Mathsin(e),o=a*n-s*i+t.x,r=a*i+s*n+t.y;return new Point(o,r)}reflect(e){let t=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,s=this.x-e.p1.x,n=this.y-e.p1.y,i=(t*n-a*s)/(t*t+a*a),o=this.x+2*i*a,r=this.y-2*i*t;return new Point(o,r)}scale(e,t=e){return new Point(this.x*e,this.y*t)}shift(e,t=e){return new Point(this.x+e,this.y+t)}translate(e){return this.shift(e.x,e.y)}add(e){return Point.sum(this,e)}subtract(e){return Point.difference(this,e)}equals(e){return Point.equals(this,e)}round(e=1){return new Point(roundTo(this.x,e),roundTo(this.y,e))}mod(e,t=e){return new Point(this.x%e,this.y%t)}static average(...e){let t=total(e.map((e)=>e.x))/e.length,a=total(e.map((e)=>e.y))/e.length;return new Point(t,a)}static dot(e,t){return e.x*t.x+e.y*t.y}static sum(e,t){return new Point(e.x+t.x,e.y+t.y)}static difference(e,t){return new Point(e.x-t.x,e.y-t.y)}static distance(e,t){return _Mathsqrt(square(e.x-t.x)+square(e.y-t.y))}static manhattan(e,t){return _Mathabs(e.x-t.x)+_Mathabs(e.y-t.y)}static interpolate(e,a,s=.5){return new Point(e.x+s*(a.x-e.x),e.y+s*(a.y-e.y))}static equals(e,t){return nearlyEquals(e.x,t.x)&&nearlyEquals(e.y,t.y)}}const origin=new Point(0,0),twoPi=2*_MathPI;class Angle{constructor(e,t,a){this.a=e,this.b=t,this.c=a}transform(e){return e?new Angle(this.a.transform(e),this.b.transform(e),this.c.transform(e)):this}get rad(){let e=_Mathatan(this.a.y-this.b.y,this.a.x-this.b.x),t=_Mathatan(this.c.y-this.b.y,this.c.x-this.b.x),a=t-e;return 0>a&&(a+=2*_MathPI),a}get deg(){return 180*this.rad/_MathPI}get size(){let e=this.rad;return _Mathmin(e,2*_MathPI-e)}get isRight(){return nearlyEquals(this.size,_MathPI/2,.01)}get bisector(){let e=_Mathatan(this.a.y-this.b.y,this.a.x-this.b.x),t=_Mathatan(this.c.y-this.b.y,this.c.x-this.b.x),a=(e+t)/2;e>t&&(a+=_MathPI);let s=_Mathcos(a)+this.b.x,n=_Mathsin(a)+this.b.y;return new Line(this.b,new Point(s,n))}}class Line{constructor(e,t){this.p1=e,this.p2=t}get length(){return Point.distance(this.p1,this.p2)}get midpoint(){return Point.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return rad(this.p2,this.p1)}get normalVector(){let e=this.length,t=(this.p2.x-this.p1.x)/e,a=(this.p2.y-this.p1.y)/e;return new Point(t,a)}get perpendicularVector(){return new Point(this.p2.y-this.p1.y,this.p1.x-this.p2.x).normal}get perpBisector(){return this.perpendicular(this.midpoint)}parallel(e){const t=Point.sum(e,Point.difference(this.p2,this.p1));return new Line(e,t)}perpendicular(e){return new Line(e,Point.sum(e,this.perpendicularVector))}contains(e){const t=e.x*(this.p1.y-this.p2.y)+this.p1.x*(this.p2.y-e.y)+this.p2.x*(e.y-this.p1.y);return nearlyEquals(t,0)}at(e){return Point.interpolate(this.p1,this.p2,e)}project(e){const t=Point.difference(this.p2,this.p1),a=Point.difference(e,this.p1),s=t.scale(Point.dot(t,a)/square(this.length));return Point.sum(this.p1,s)}transform(e){return e?new this.constructor(this.p1.transform(e),this.p2.transform(e)):this}rotate(e,t=origin){return new this.constructor(this.p1.rotate(e,t),this.p2.rotate(e,t))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,t=e){return new this.constructor(this.p1.scale(e,t),this.p2.scale(e,t))}shift(e,t=e){return new this.constructor(this.p1.shift(e,t),this.p2.shift(e,t))}translate(e){return new this.constructor(this.p1.translate(e),this.p2.translate(e))}equals(e){return this.constructor.equals(this,e)}static equals(e,t){return e.contains(t.p1)&&e.contains(t.p2)}}class Ray extends Line{}class Segment extends Line{contains(){}project(e){const t=Point.difference(this.p2,this.p1),a=Point.difference(e,this.p1),s=clamp(Point.dot(t,a)/square(this.length),0,1);return Point.sum(this.p1,t.scale(s))}static equals(e,t,a=!1){return Point.equals(e.p1,t.p1)&&Point.equals(e.p2,t.p2)||!a&&Point.equals(e.p1,t.p2)&&Point.equals(e.p2,t.p1)}static intersect(e,t){const a=new Segment(e.p1,e.p2),s=new Segment(t.p1,t.p2);return intersections(a,s)[0]||null}}class Circle{constructor(e=origin,t=1){this.c=e,this.r=t}get circumference(){return 2*_MathPI*this.r}get area(){return _MathPI*square(this.r)}get arc(){let e=this.c.shift(this.r,0);return new Arc(this.c,e,twoPi)}transform(e){return e?new Circle(this.c.transform(e),this.r*(e[0][0]+e[1][1])/2):this}rotate(e,t=origin){return new Circle(this.c.rotate(e,t),this.r)}reflect(e){return new Circle(this.c.reflect(e),this.r)}scale(e,t=e){return new Circle(this.c.scale(e,t),this.r*(e+t)/2)}shift(e,t=e){return new Circle(this.c.shift(e,t),this.r)}translate(e){return new Circle(this.c.translate(e),this.r)}contains(e){return Point.distance(e,this.c)<=this.r}equals(e){return e instanceof Circle&&nearlyEquals(this.r,e.r)&&this.c.equals(e.c)}project(e){const t=Point.difference(e,this.c).normal.scale(this.r);return Point.sum(this.c,t)}at(e){const t=2*_MathPI*e;return this.c.shift(this.r*_Mathcos(t),this.r*_Mathsin(t))}}class Arc{constructor(e,t,a){this.c=e,this.start=t,this.angle=a}get radius(){return Point.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}transform(e){return e?new Arc(this.c.transform(e),this.start.transform(e),this.angle):this}get startAngle(){return rad(this.start,this.c)}project(e){let t=this.startAngle,a=t+this.angle,s=rad(e,this.c);return a>twoPi&&s<a-twoPi&&(s+=twoPi),s=clamp(s,t,a),this.c.shift(this.radius,0).rotate(s,this.c)}at(e){return this.start.rotate(this.angle*e,this.c)}contract(e){return new Arc(this.c,this.at(e/2),this.angle*(1-e))}}class Polygon{constructor(...e){this.points=e}get circumference(){let e=0;for(let t=1;t<this.points.length;++t)e+=Point.distance(this.points[t-1],this.points[t]);return e}get signedArea(){let e=this.points,t=e.length,a=e[t-1].x*e[0].y-e[0].x*e[t-1].y;for(let s=1;s<t;++s)a+=e[s-1].x*e[s].y-e[s].x*e[s-1].y;return a/2}get area(){return _Mathabs(this.signedArea)}get centroid(){let e=this.points,t=e.length,a=0;for(let s=0;s<t;++s)a+=e[s].x;let s=0;for(let a=0;a<t;++a)s+=e[a].y;return new Point(a/t,s/t)}get edges(){let e=this.points,t=e.length,a=[];for(let s=0;s<t;++s)a.push(new Segment(e[s],e[(s+1)%t]));return a}transform(e){return e?new this.constructor(...this.points.map((t)=>t.transform(e))):this}rotate(e,t=origin){const a=this.points.map((a)=>a.rotate(e,t));return new this.constructor(...a)}reflect(e){const t=this.points.map((t)=>t.reflect(e));return new this.constructor(...t)}scale(e,t=e){const a=this.points.map((a)=>a.scale(e,t));return new this.constructor(...a)}shift(e,t=e){const a=this.points.map((a)=>a.shift(e,t));return new this.constructor(...a)}translate(e){return this.shift(e.x,e.y)}contains(e){let t=this.points.length,a=!1;for(let s=0;s<t;++s){const n=this.points[s],i=this.points[(s+1)%t],o=n.y>e.y!=i.y>e.y,r=e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x;o&&r&&(a=!a)}return a}equals(){}project(){}at(){}get oriented(){if(0<=this.signedArea)return this;const e=[...this.points].reverse();return new Polygon(...e)}intersect(e){const t=[toLinkedList(this.oriented.points),toLinkedList(e.oriented.points)],a=this.points.length+e.points.length,s=[];let n=0,i=t[n].find((t)=>e.contains(t.val));if(!i)return null;for(;i.val!==s[0]&&s.length<a;){s.push(i.val);const e=new Segment(i.val,i.next.val);i=i.next;for(let a of t[1-n]){const t=new Segment(a.val,a.next.val),s=intersections(e,t)[0];if(s){n=1-n,i={val:s,next:a.next};break}}}return new Polygon(...s)}static collision(e,t){for(let a of e.edges)for(let e of t.edges)if(Segment.intersect(a,e))return!0;for(let a of e.points)if(t.contains(a))return!0;for(let a of t.points)if(e.contains(a))return!0;return!1}}class Polyline extends Polygon{get edges(){let e=[];for(let t=0;t<this.points.length-1;++t)e.push(new Segment(this.points[t],this.points[t+1]));return e}}class Triangle extends Polygon{constructor(e,t,a){super(e,t,a)}get circumcircle(){const e=this.points,t=2*(e[0].x*(e[1].y-e[2].y)+e[1].x*(e[2].y-e[0].y)+e[2].x*(e[0].y-e[1].y)),a=(square(e[0].x)+square(e[0].y))*(e[1].y-e[2].y)+(square(e[1].x)+square(e[1].y))*(e[2].y-e[0].y)+(square(e[2].x)+square(e[2].y))*(e[0].y-e[1].y),s=(square(e[0].x)+square(e[0].y))*(e[2].x-e[1].x)+(square(e[1].x)+square(e[1].y))*(e[0].x-e[2].x)+(square(e[2].x)+square(e[2].y))*(e[1].x-e[0].x),n=new Point(a/t,s/t),i=Point.distance(n,this.points[0]);return new Circle(n,i)}get incircle(){const e=this.edges,t=e.map((t)=>t.length),a=t[0]+t[1]+t[2],s=this.points,n=t[1]*s[0].x+t[2]*s[1].x+t[0]*s[2].x,i=t[1]*s[0].y+t[2]*s[1].y+t[0]*s[2].y,o=new Point(n/a,i/a),r=o.distanceFromLine(e[0]);return new Circle(o,r)}get orthocenter(){const e=this.points,t=e[0],a=e[1],s=e[2],n=new Line(t,a).perpendicular(s),i=new Line(t,s).perpendicular(a);return intersections(n,i)[0]}}class Rectangle{constructor(e,t=1,a=t){this.p=e,this.w=t,this.h=a}get center(){return new Point(this.p.x+this.w/2,this.p.y+this.h/2)}get circumference(){return 2*_Mathabs(this.w)+2*_Mathabs(this.h)}get area(){return _Mathabs(this.w*this.h)}get edges(){return this.polygon.edges}get polygon(){let e=new Point(this.p.x+this.w,this.p.y),t=new Point(this.p.x+this.w,this.p.y+this.h),a=new Point(this.p.x,this.p.y+this.h);return new Polygon(this.p,e,t,a)}transform(e){return e?this.polygon.transform(e):this}rotate(e,t=origin){return this.polygon.rotate(e,t)}reflect(e){return this.polygon.reflect(e)}scale(e,t=e){return new Rectangle(this.p.scale(e,t),this.w*e,this.h*t)}shift(e,t=e){return new Rectangle(this.p.shift(e,t),this.w,this.h)}translate(e){return new Rectangle(this.p.translate(e),this.w,this.h)}contains(){}equals(){}project(e){let t={x:this.p.x+this.w,y:this.p.y+this.h},a={x:this.p.x+this.w/2,y:this.p.y+this.h/2},s=(a.y-e.y)/(a.x-e.x);if(e.x<=a.x){let a=s*(this.p.x-e.x)+e.y;if(this.p.y<a&&a<t.y)return new Point(this.p.x,a)}if(e.x>=a.x){let a=s*(t.x-e.x)+e.y;if(this.p.y<a&&a<t.y)return new Point(t.x,a)}if(e.y<=a.y){let a=(this.p.y-e.y)/s+e.x;if(this.p.x<a&&a<t.x)return new Point(a,this.p.y)}if(e.y>=a.y){let a=(t.y-e.y)/s+e.x;if(this.p.x<a&&a<t.x)return new Point(a,t.y)}}at(){}}const prefixes={da:{name:'deca',value:10},h:{name:'hecto',value:100},k:{name:'kilo',value:1e3},M:{name:'mega',value:1e6},G:{name:'giga',value:1e9},T:{name:'tera',value:1e12},P:{name:'peta',value:1e15},E:{name:'exa',value:1e18},Z:{name:'zetta',value:1e21},Y:{name:'yotta',value:1e24},d:{name:'deci',value:.1},c:{name:'centi',value:.01},m:{name:'milli',value:1e-3},u:{name:'micro',value:1e-6},n:{name:'nano',value:1e-9},p:{name:'pico',value:1e-12},f:{name:'femto',value:1e-15},a:{name:'atto',value:1e-18},z:{name:'zepto',value:1e-21},y:{name:'yocto',value:1e-24}},units={m:{name:'meter',type:'length',value:1},in:{name:'inch',type:'length',value:.0254},ft:{name:'foot',type:'length',value:.3048},yd:{name:'yard',type:'length',value:.9144},mi:{name:'mile',type:'length',value:1609.344},AA:{name:'angstrom',type:'length',value:1e-10},m2:{name:'m2',type:'surface',power:2,value:1},sqin:{name:'sqin',type:'surface',power:2,value:64516e-8},sqft:{name:'sqft',type:'surface',power:2,value:.09290304},sqyd:{name:'sqyd',type:'surface',power:2,value:.83612736},sqmi:{name:'sqmi',type:'surface',power:2,value:2589988.110336},m3:{name:'m3',type:'volume',value:1},l:{name:'litre',type:'volume',value:.001},cup:{name:'cup',type:'volume',value:.0002365882},pint:{name:'pint',type:'volume',value:.0004731765},quart:{name:'quart',type:'volume',value:.0009463529},gallon:{name:'gallon',type:'volume',value:.003785412},barrel:{name:'barrel',type:'volume',value:.1589873},g:{name:'gram',type:'mass',value:.001},ton:{name:'ton',type:'mass',value:907.18474},oz:{name:'ounce',type:'mass',value:.028349523125},lbm:{name:'pound',type:'mass',value:.45359237},s:{name:'second',type:'time',value:1},min:{name:'minute',type:'time',value:60},h:{name:'hour',type:'time',value:3600},d:{name:'day',type:'time',value:86400},w:{name:'week',type:'time',value:604800},mon:{name:'month',type:'time',value:2629740},y:{name:'year',type:'time',value:31556900},rad:{name:'rad',type:'angle',value:1},deg:{name:'deg',type:'angle',value:.017453292519943295},grad:{name:'grad',type:'angle',value:.015707963267948967},cyc:{name:'cycle',type:'angle',value:6.283185307179586},A:{name:'ampere',type:'current',value:1},K:{name:'kelvin',type:'temperature',value:1},degC:{name:'celsius',type:'temperature',value:1,offset:273.15},degF:{name:'fahrenheit',type:'temperature',value:1/1.8,offset:459.67},mol:{name:'mole',type:'substance',value:1},N:{name:'newton',type:'force',value:1},lbf:{name:'poundforce',type:'force',value:4.4482216152605},b:{name:'bits',type:'data',value:1},B:{name:'bytes',type:'data',value:8}},prefixRegexp=Object.keys(prefixes).join('|'),unitRegexp=Object.keys(units).join('|');let isReady=!1;setTimeout(function(){isReady=!0});const cssMatrix=/matrix\([0-9.\s]+,[0-9.\s]+,[0-9.\s]+,[0-9.\s]+,([0-9.\s]+),([0-9.\s]+)\)/,browserEvents=new Evented,ua=window.navigator.userAgent,mobileRegex=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i;let width=window.innerWidth,height=window.innerHeight;window.onresize=throttle(function(){let e=window.innerWidth,t=window.innerHeight;width===e&&800>width&&800>t||(width=e,browserEvents.trigger('resize',{width,height:t}),$body.trigger('scroll',{top:$body.scrollTop}))},100);const doResize=throttle(function(){width=window.innerWidth,height=window.innerHeight,browserEvents.trigger('resize',{width,height})});let loadQueue=[],loaded=!1;window.onload=afterLoad,document.addEventListener('DOMContentLoaded',afterLoad);const STORAGE_KEY='_M',keyCodes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},IEUA=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,webkitUA=/\bAppleWebKit\/(\d+)\b/,EdgeUA=/\bEdge\/12\.(\d+)\b/,polyfill=IEUA.test(navigator.userAgent)||10547>(navigator.userAgent.match(EdgeUA)||[])[1]||537>(navigator.userAgent.match(webkitUA)||[])[1],requests={};let isOldWebkit=!('hidden'in document)&&'webkitHidden'in document,visibilityProperty=isOldWebkit?'webkitHidden':'hidden',visibilityEvent=isOldWebkit?'webkitvisibilitychange':'visibilitychange';document.addEventListener(visibilityEvent,function(){browserEvents.trigger(document[visibilityProperty]?'focus':'blur')});const Browser={isMobile:mobileRegex.test(navigator.userAgent.toLowerCase()),isRetina:1<(window.devicePixelRatio||1),isTouch:'ontouchstart'in window||window.DocumentTouch&&document instanceof window.DocumentTouch,isChrome:window.chrome,isIE:0<=ua.indexOf('MSIE')||0<=ua.indexOf('Trident'),isFirefox:0<=navigator.userAgent.search('Firefox'),redraw,ready,resize,cssTimeToNumber,addCSS,addCSSRule,replaceSvgImports,on:browserEvents.on.bind(browserEvents),off:browserEvents.off.bind(browserEvents),trigger:browserEvents.trigger.bind(browserEvents),get width(){return width},get height(){return height},get hash(){return window.location.hash.slice(1)},set hash(e){let t=document.body.scrollTop;window.location.hash=e,document.body.scrollTop=t},get cookies(){return getCookies()},getCookie,setCookie,deleteCookie,setStorage,getStorage,deleteStorage,get activeInput(){return activeInput()},keyCodes,onKey};let observer,touchEnabled=!1;document.addEventListener('touchstart',()=>touchEnabled=!0);const aliases={change:'propertychange keyup input paste',scrollwheel:'DOMMouseScroll mousewheel',pointerdown:'mousedown touchstart',pointermove:'mousemove touchmove',pointerup:'mouseup touchend',pointercancel:'touchcancel',pointerstop:'mouseup touchend touchcancel'},customEvents={scroll:makeScrollEvents,hover:makeHoverEvent,click:makeClickEvent,clickOutside:makeClickOutsideEvent,mousedown:makeMouseEvent.bind(null,'mousedown'),mousemove:makeMouseEvent.bind(null,'mousemove'),mouseup:makeMouseEvent.bind(null,'mouseup'),pointerenter:makePointerPositionEvents,pointerleave:makePointerPositionEvents,enterViewport:makeIntersectionEvents,exitViewport:makeIntersectionEvents},ALPHABETH='zyxwvutsrqponmlkjihgfedcba';class Element{constructor(e){this._el=e,this._data=e?e._m_data||(e._m_data={}):{},this._events=e?e._m_events||(e._m_events={}):{}}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el instanceof Text?'TEXT':this._el.tagName.toUpperCase()}getModel(){return this.parent?this.parent.model||this.parent.getModel():null}bindObservable(e,t=!0){return bindObservable(this,e,t),e}addClass(e){let t=words(e);if(this._el.classList)for(let e of t)this._el.classList.add(e);else this._el.className+=' '+e}removeClass(e){let t=words(e);if(this._el.classList)for(let e of t)this._el.classList.remove(e);else{let e=new RegExp('(^|\\s)'+t.join('|')+'(\\s|$)','gi');this._el.className=this._el.className.toString().replace(e,' ')}}hasClass(e){let t=this._el.className;return 0<=(' '+t+' ').indexOf(' '+e.trim()+' ')}toggleClass(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)}setClass(e,t){t?this.addClass(e):this.removeClass(e)}attr(e){return this._el.getAttribute(e)}hasAttr(e){return this._el.hasAttribute(e)}setAttr(e,t){this._el.setAttribute(e,t)}removeAttr(e){this._el.removeAttribute(e)}get attributes(){return Array.from(this._el.attributes||[])}get value(){return this._el.value}set value(e){this._el.value=e}get html(){return this._el.innerHTML||''}set html(e){this._el.innerHTML=e}get text(){return this._el.textContent||''}set text(e){this._el.textContent=e}blur(){this._el.blur()}focus(){this._el.focus()}get bounds(){return this._el.getBoundingClientRect()}get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){let e=this._el.offsetParent;return e?$(e):null}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){const e=parseFloat(this.css('padding-left')),t=parseFloat(this.css('padding-right'));return this._el.clientWidth-e-t}get innerHeight(){const e=parseFloat(this.css('padding-bottom')),t=parseFloat(this.css('padding-top'));return this._el.clientHeight-e-t}get outerWidth(){const e=parseFloat(this.css('margin-left')),t=parseFloat(this.css('margin-right'));return this.width+e+t}get outerHeight(){const e=parseFloat(this.css('margin-bottom')),t=parseFloat(this.css('margin-top'));return this.height+e+t}get positionTop(){let e=this._el,t=0;do t+=e.offsetTop;while(e=e.offsetParent);return t}get positionLeft(){let e=this._el,t=0;do t+=e.offsetLeft;while(e=e.offsetParent);return t}get boxCenter(){let e=this.bounds;return{x:e.left+e.width/2,y:e.top+e.height/2}}offset(e){if(e._el===this._el.offsetParent){let t=this.offsetTop+e._el.clientTop,a=this.offsetLeft+e._el.clientLeft,s=t+this.height,n=a+this.width;return{top:t,left:a,bottom:s,right:n}}else{let t=e._el.getBoundingClientRect(),a=this._el.getBoundingClientRect();return{top:a.top-t.top,left:a.left-t.left,bottom:a.bottom-t.top,right:a.right-t.left}}}get isInViewport(){const e=this.bounds;return isBetween(e.top,-e.height,Browser.height)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}get scrollLeft(){return this._el.scrollLeft}set scrollTop(e){this._el.scrollTop=e,this.trigger('scroll',{top:e,left:this.scrollLeft})}set scrollLeft(e){this._el.scrollLeft=e,this.trigger('scroll',{top:this.scrollTop,left:e})}fixOverflowScroll(){this._data._fixOverflowScroll||(this._data._fixOverflowScroll=!0,this._el.addEventListener('touchstart',()=>{const e=this.scrollTop,t=this.scrollHeight-this.height;0>=e&&(this.scrollTop=1),e>=t&&(this.scrollTop=t-1)}))}scrollTo(e,t=1e3,a='cubic'){0>e&&(e=0);const s=this.scrollTop,n=e-s;animate((e)=>{const t=s+n*ease(a,e);this.scrollTop=t,this.trigger('scroll',{top:t})},t)}scrollBy(e,t=1e3,a='cubic'){e&&this.scrollTo(this.scrollTop+e,t,a)}css(e,t){if(!(t===void 0))this._el.style[toCamelCase(e)]=t;else if('string'==typeof e)return window.getComputedStyle(this._el).getPropertyValue(e);else{const t=Object.keys(e);for(let a of t)this._el.style[toCamelCase(a)]=e[a]}}get transition(){return this.css('transform')}set transition(e){this._el.style.transition=e}get transform(){return this.css('transform').replace('none','')}set transform(e){this._el.style.transform=e}get transformMatrix(){let e=this.css('transform');if(!e||'none'===e)return[[1,0,0],[0,1,0]];let t=e.match(/matrix\(([0-9\,\.\s\-]*)\)/);if(!t[1])return[[1,0,0],[0,1,0]];let a=t[1].split(',');return[[+a[0],+a[2],+a[4]],[+a[1],+a[3],+a[5]]]}get scale(){let e=this.transformMatrix;return[e[0][0],e[1][1]]}translate(e,t){e=roundTo(+e||0,.1),t=roundTo(+t||0,.1),this.transform=`translate(${e}px,${t}px)`}translateX(e){this.transform=`translate(${roundTo(+e||0,.1)}px,0)`}translateY(e){this.transform=`translate(0,${roundTo(+e||0,.1)}px)`}show(){this.hasAttr('hidden')&&this.removeAttr('hidden'),'visibility'===this.data.display?this._el.style.visibility='visible':this._el.style.display=this.data.display||'block'}hide(){'visibility'===this.data.display?this._el.style.visibility='hidden':this._el.style.display='none'}transitionEnd(e){this.one('transitionend',e)}animationEnd(e){this.one('animationend',e)}is(e){return this._el.matches?this._el.matches(e):-1<[].indexOf.call(document.querySelectorAll(e),this._el)}index(){let e=0,t=this._el;for(;null!==(t=t.previousSibling);)++e;return e}prepend(e){let t=this._el.childNodes;if('string'==typeof e){let t=$$N(e);for(let e=t.length-1;0<=e;--e)this._el.insertBefore(t[e],this._el.childNodes[0])}else t.length?this._el.insertBefore(e._el,t[0]):this._el.appendChild(e._el)}append(e){if('string'==typeof e){let t=$$N(e);for(let e of t)this._el.appendChild(e._el)}else this._el.appendChild(e._el)}insertBefore(e){let t=this.parent;if('string'==typeof e){let a=$$N(e);for(let e=a.length-1;0<=e;--e)t._el.insertBefore(a[e]._el,this._el)}else t._el.insertBefore(e._el,this._el)}insertAfter(e){let t=this.parent;if('string'==typeof e){let a=$$N(e);for(let e of a)t._el.insertAfter(this._el,e._el)}else{let a=this._el.nextSibling;a?t._el.insertBefore(e._el,a):t._el.appendChild(e._el)}}wrap(e){return'string'==typeof e&&(e=$N(e)),this.insertBefore(e),this.detach(),e.append(this),e}moveTo(e,t=!1){t?e.prepend(this):e.append(this)}get next(){let e=this._el.nextSibling;return e?$(e):null}get prev(){let e=this._el.previousSibling;return e?$(e):null}$(e){return $(e,this)}$$(e){return $$(e,this)}get parent(){let e=this._el.parentElement;return e?$(e):null}get siblings(){let e=[],t=this._el.parentNode.firstChild;do e.push($(t));while(t=t.nextSibling);return e}parents(e){let t=[],a=this.parent;for(;a;)(!e||a.is(e))&&t.push(a),a=a.parent;return t}hasParent(...e){for(let t=e.map((e)=>e._el),a=this._el.parentNode;a;){if(isOneOf(a,...t))return!0;a=a.parentNode}return!1}get children(){let e=this._el.children||[];return Array.from(e,(e)=>$(e))}get childNodes(){let e=this._el.childNodes||[];return Array.from(e,(e)=>$(e))}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach(),this._el=null}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}replaceWith(...e){for(let t of e)this.insertBefore(t);this.remove()}on(t,a=null,s=!1){if(a)for(let n of words(t))createEvent(this,n,a,s);else for(let a of Object.keys(t))createEvent(this,a,t[a])}one(e,t,a=!1){const s=()=>{this.off(e,s,a),t(e,t,a)};this.on(e,s,a)}off(t,a,s=!1){for(let n of words(t))removeEvent(this,n,a,s)}trigger(t,a={}){for(let s of words(t)){if(!this._events[s])return;for(let e of this._events[s])e.call(this,a)}}onKeyDown(t,a){t=words(t).map((e)=>Browser.keyCodes[e]||e),this._el.addEventListener('keydown',function(s){0<=t.indexOf(s.keyCode)&&a(s)})}animate(e,t,a,s){return transition(this,e,t,a,s)}enter(e,t,a){return enter(this,e,t,a)}exit(e,t,a){return exit(this,e,t,a)}effect(e){effect(this,e)}fadeIn(e=400){return enter(this,'fade',e)}fadeOut(e=400){return exit(this,'fade',e)}get cursor(){let e=window.getSelection();if(!e.rangeCount)return[0,0];let t=window.getSelection().getRangeAt(0),a=t.cloneRange();a.selectNodeContents(this._el),a.setEnd(t.startContainer,t.startOffset);let s=a.toString().length;a.setEnd(t.endContainer,t.endOffset);let n=a.toString().length;return[s,n]}}class WindowElement extends Element{get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}get scrollLeft(){return window.pageXOffset}set scrollTop(e){document.body.scrollTop=document.documentElement.scrollTop=e,this.trigger('scroll',{top:e,left:this.scrollLeft})}set scrollLeft(e){document.body.scrollLeft=document.documentElement.scrollLeft=e,this.trigger('scroll',{top:this.scrollTop,left:e})}}class FormElement extends Element{get action(){return this._el.action}get formData(){let e={},t=this._el.elements;for(let a=0;a<t.length;++a)e[t[a].name||t[a].id]=t[a].value;return e}change(e){let t='';this.on('change',()=>{this.value===t||(t=this.value.trim(),e(t))})}validate(e){this.change((t)=>{this.setValidity(e(t))})}setValidity(e){this._el.setCustomValidity(e||'')}get isValid(){return this._el.checkValidity()}}class SVGElement extends Element{hasClass(e){let t=this._el.className.baseVal;return 0<=(' '+t+' ').indexOf(' '+e.trim()+' ')}get width(){return this.bounds.width}get height(){return this.bounds.height}get viewBox(){return this._el.viewBox.baseVal||{}}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get positionTop(){let e=this.parent;for(;e instanceof SVGElement;)e=e.parent;return e.positionTop+this._el.getBBox().y}get positionLeft(){let e=this.parent;for(;e instanceof SVGElement;)e=e.parent;return e.positionLeft+this._el.getBBox().x}get inverseTransformMatrix(){const e=this._el.getScreenCTM().inverse(),t=[[e.a,e.c,e.e],[e.b,e.d,e.f]];if(Browser.isFirefox){let e=this.transformMatrix;t[0][2]-=e[0][2],t[1][2]-=e[1][2]}return t}get strokeLength(){if('getTotalLength'in this._el)return this._el.getTotalLength();if(this._el instanceof SVGLineElement)return _Mathsqrt(square(this._el.x2.baseVal.value-this._el.x1.baseVal.value)+square(this._el.y2.baseVal.value-this._el.y1.baseVal.value));else{let e=this.bounds;return 2*e.height+2*e.width}}getPointAt(e){return this._el.getPointAtLength(e*this.strokeLength)}getPointAtLength(e){return this._el.getPointAtLength(e)}get points(){let e=this.attr('d');return e?e.replace(/[MZ]/g,'').split(/[LA]/).map((e)=>{let t=e.split(',');return{x:+t[t.length-2],y:+t[t.length-1]}}):[]}set points(e){let t=e.length?'M'+e.map((e)=>e.x+','+e.y).join('L'):'';this.setAttr('d',t)}addPoint(e){let t=this.attr('d')+' L '+e.x+','+e.y;this.setAttr('d',t)}get center(){return new Point(+this.attr('cx'),+this.attr('cy'))}setCenter(e){this.setAttr('cx',e.x),this.setAttr('cy',e.y)}setLine(e,t){this.setAttr('x1',e.x),this.setAttr('y1',e.y),this.setAttr('x2',t.x),this.setAttr('y2',t.y)}}class CanvasElement extends Element{getContext(e='2d',t){return this._el.getContext(e,t)}get pngImage(){return this._el.toDataURL('image/png')}}const svgTags=['path','rect','circle','ellipse','polygon','polyline','g','defs','marker','line','text','pattern','mask','svg'],formTags=['form','input','select'],$window=new WindowElement(window),$html=new WindowElement(window.document.documentElement),$body=new WindowElement(document.body);let POST_DATA={};const doDeferredPost=throttle(sendLogs,5e3);window.addEventListener('online',doDeferredPost),window.onbeforeunload=function(){sendLogs()};const shortHexRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longHexRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rainbow=['#D92120','#E6642C','#E68E34','#D9AD3C','#B5BD4C','#7FB972','#63AD99','#55A1B1','#488BC2','#4065B1','#413B93','#781C81'],temperature=['#3D52A1','#3A89C9','#77B7E5','#B4DDF7','#E6F5FE','#FFFAD2','#FFE3AA','#F9BD7E','#ED875E','#D24D3E','#AE1C3E'],solar=['#FFFFE5','#FFF7BC','#FEE391','#FEC44F','#FB9A29','#EC7014','#CC4C02','#993404','#662506'];class Colour{static get red(){return'#D90000'}static get orange(){return'#F15A24'}static get yellow(){return'#edd200'}static get lime(){return'#b2d300'}static get green(){return'#00B200'}static get cyan(){return'#29ABE2'}static get blue(){return'#006DD9'}static get violet(){return'#662D91'}static get purple(){return'#9d0069'}static get pink(){return'#ED1E79'}static rainbow(e){let t=clamp(.4+.15*e,0,1);return tabulate((a)=>getColourAt(rainbow,t*a/(e-1)),e)}static temperature(e){let t=clamp(.1*e,0,1);return tabulate(function(a){return getColourAt(temperature,(1-t)/2+t*a/(e-1))},e)}static solar(e){return tabulate((t)=>getColourAt(solar,t/(e-1)),e)}constructor(e,t,s,n=1){this.r=e,this.g=t,this.b=s,this.a=n}static fromHex(e){e=e.replace(shortHexRegex,function(e,t,a,s){return t+t+a+a+s+s});let t=longHexRegex.exec(e);return t?new Colour(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):new Colour(0,0,0)}static fromRgb(e){let t=e.replace(/rgba?\(/,'').replace(')','').split(',');return new Colour(+t[0],+t[1],+t[2],3<t.length?+t[3]:1)}get hex(){let e=[this.r,this.g,this.b].map((e)=>pad2(_Mathround(e).toString(16)));return'#'+e.join('')}get rgb(){let e=[this.r,this.g,this.b].map((e)=>_Mathround(e)).join(',');return'rgba('+e+','+this.a+')'}get hsl(){let e,t,a=this.r/255,s=this.g/255,n=this.b/255,i=_Mathmax(a,s,n),o=_Mathmin(a,s,n),r=(i+o)/2;if(i===o)e=t=0;else{let l=i-o;t=.5<r?l/(2-i-o):l/(i+o);i===a?e=(s-n)/l+(s<n?6:0):i===s?e=(n-a)/l+2:i===n?e=(a-s)/l+4:void 0;e/=6}return'hsl('+[e,t,r].join(',')+')'}get complement(){}get inverse(){}toString(){return this.rgb}lighten(){}darken(){}saturate(){}desaturate(){}grayscale(e=1){}}class Draggable extends Evented{constructor(e,t,a='',s=0,n=!1,i=1){super();let o,r,l=this;this.$el=e,this._posn={x:null,y:null},this.move={x:'y'!==a,y:'x'!==a},this.useTransform=n,this.snap=i,this.disabled=!1,slide(e,{start:function(e){l.disabled||(o=e,r=!0,l.trigger('start'))},move:function(e){if(!l.disabled){r=!1;let t=clamp(l._posn.x+e.x-o.x,0,l.width),a=clamp(l._posn.y+e.y-o.y,0,l.height);o=e,l.position={x:t,y:a},l.trigger('drag')}},end:function(){l.disabled||l.trigger(r?'click':'end')}}),Browser.resize(function(){let e=l.width,a=l.height;l.width=t.width-2*s,l.height=t.height-2*s;let n=l.width/e*l._posn.x,i=l.height/a*l._posn.y;l.draw({x:n,y:i})})}get position(){return{x:roundTo(this._posn.x,this.snap),y:roundTo(this._posn.y,this.snap)}}set position(e){this.draw(e),this._posn=e,this.trigger('move',e)}draw({x:e,y:t}){this.snap&&(e=roundTo(e,this.snap),t=roundTo(t,this.snap)),this.useTransform?this.$el.translate(this.move.x?_Mathround(e):0,this.move.y?_Mathround(t):0):(this.move.x&&this.$el.css('left',_Mathround(e)+'px'),this.move.y&&this.$el.css('top',_Mathround(t)+'px'))}}'scrollRestoration'in history&&(history.scrollRestoration='manual');const onPopState=function(){let t=!1;return'complete'===document.readyState?t=!0:window.addEventListener('load',function(){setTimeout(function(){t=!0})}),function(a){t&&a.state&&this.goToState(a.state)}}();class _Router extends Evented{setup(e){this.$viewport=e.$viewport||$body,this.preloaded=e.preloaded||!1,this.transition=e.transition||!1,this.initialise=e.initialise||noop,this.views=[],this.active=null,this.current='',e.click&&$body.on('click',onLinkClick.bind(this)),e.history&&window.addEventListener('popstate',onPopState.bind(this))}get hash(){return window.location.hash.slice(1)}set hash(e){window.location.hash=e,this.trigger('hashChange',e)}view(e,{enter:t,exit:a,template:s}={}){let n=(e.match(/:\w+/g)||[]).map((e)=>e.substr(1)),i=e.replace(/:\w+/g,'([\\w-]+)').replace('/','\\/')+'\\/?',o=new RegExp('^'+i+'$'),r={regex:o,params:n,enter:t,exit:a,template:s};this.views.push(r);let l=getViewParams(window.location.pathname,r);l&&(this.active={path:window.location.pathname,hash:window.location.hash,index:0},window.history.replaceState(this.active,'',this.active.path+this.active.hash),Browser.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,l),r.enter&&r.enter(this.$viewport,l)):loadView(this,r,l,this.location.pathname)})}))}paths(...e){e.forEach((e)=>{this.view(e)})}getView(e){for(let t of this.views){let a=getViewParams(e,t);if(a)return{view:t,params:a}}}load(e,t=''){let a=this.getView(e);return e==this.active.path&&t!=this.active.hash?(console.info('[boost] Routing to '+e+t),this.trigger('hashChange',t.slice(1)),this.trigger('change',e+t),!0):!!(a&&e!=this.active.path)&&(console.info('[boost] Routing to '+e+t),this.trigger('change',e+t),loadView(this,a.view,a.params,e),!0)}goToState(e){if(e&&e.path){let t=this.load(e.path,e.hash);t&&e.index<this.active.index&&this.trigger('back'),t&&e.index>this.active.index&&this.trigger('forward'),this.active=e}}goTo(e,t){let a=this.load(e,t);if(a){let a=this.active?this.active.index+1:0;this.active={path:e,hash:t,index:a},window.history.pushState(this.active,'',e+t)}return a}back(){window.history.back()}forward(){window.history.forward()}}const Router=new _Router,customElementOptions=new Map;class CustomHTMLElement extends HTMLElement{connectedCallback(){if(this._wasConnected)return void this.$el.trigger('connected');this._wasConnected=!0,this._isReady=!1,this.$el.created&&this.$el.created();const e=customElementOptions.get(this.$el.tagName);(e.template||e.templateId)&&applyTemplate(this,e);let t=customElementChildren(this).filter((e)=>!e._isReady).map((e)=>new Promise((t)=>e.addEventListener('_ready',t)));Promise.all(t).then(()=>{this.$el.ready&&this.$el.ready(),this.dispatchEvent(new CustomEvent('_ready')),this._isReady=!0})}disconnectedCallback(){this.$el.trigger('disconnected')}attributeChangedCallback(e,t,a){this.$el.trigger('attr:'+e,{newVal:a,oldVal:t})}}class CustomElement extends Element{constructor(e){super(e)}created(){}ready(){}static get template(){}static get templateId(){}}class Blank extends CustomElement{ready(){this.choices=this.attr('choices').split('|'),this.removeAttr('choices'),this.done=!1,this.$target=this.$('.target');const e=this.$('.popup'),t=intArray(this.choices.length);t.forEach((t)=>{let a=$N('div',{class:'choice',html:this.choices[t]},e);a.on('click',()=>{this.removeClass('on'),t?(this.$target.html=this.choices[t],this.addClass('invalid'),this.trigger('invalid')):(this.solve(),this.trigger('valid',this.choices[0]))})}),this.on('hover',{enter:()=>{if(!this.done){this.addClass('on');const t=this.$target.bounds,a=e.width,s=e.height;this.setClass('left',t.left+a>Browser.width-15),this.setClass('top',t.top+t.height+s>Browser.height-10)}},exit:()=>{this.removeClass('on')},delay:100,$clickTarget:this.$target})}solve(){this.done=!0,this.$target.html=this.choices[0],this.removeClass('on invalid'),this.addClass('done')}}class BlankInput extends CustomElement{ready(){const e=this.solution=this.attr('solution');this.removeAttr('solution'),this.done=!1,this.$input=this.$('input'),this.$target=this.$('.target'),this.$input.attr('type',Browser.isMobile?'number':'text');let t='',a=0;this.$input.change((a)=>{t=a,(a===e||toWord(a)===e||a===toWord(e))&&(this.solve(),this.trigger('valid',t))}),this.$input.on('focus',()=>{this.addClass('on'),this.removeClass('invalid'),this.$input.setAttr('placeholder',' ')}),this.$input.on('blur',()=>{this.removeClass('on'),this.setClass('invalid',t&&!this.done),this.$input.setAttr('placeholder','???'),t&&!this.done&&(a+=1,3<=a?this.trigger('hint',this.solution):this.trigger('invalid'))})}solve(){this.done=!0,this.$input.remove(),this.$target.html=this.solution,this.addClass('done')}}registerElement('x-blank-input',BlankInput,{templateId:'#blank-input'}),registerElement('x-blank',Blank,{templateId:'#blank'});class CoordinateSystem extends CustomElement{ready(){function e(e){if(b){x.removeChildren();for(let t of e){function a(a){let e=svgPointerPosn(a,s),n={x:e.x,y:m(t(d(e.x)))};r.setCenter(n),i.setLine({x:l(0),y:n.y},n),o.setLine({x:n.x,y:m(0)},n)}let n=$N('g',{style:'display:none'},x),i=$N('line',{},n),o=$N('line',{},n),r=$N('circle',{r:4},n);s.on('touchstart mouseover',function(t){n.show(),a(t)},{passive:!0}),s.on('touchend mouseout',function(){n.hide()},{passive:!0}),s.on('pointermove',a)}}}function t(t){if(t&&!(0<=t.indexOf('${'))){y.removeChildren();let a=t.split(',').map((e)=>{let t=new Expression(e);return function(e){return t.evaluate({x:e})}});for(let e of a){let t=$N('g',{},y),a=$N('path',{},t);a.points=list(0,600,2).map((t)=>({x:t,y:m(e(d(t)))}))}e(a)}}function a(e){if(_.removeChildren(),e&&!(0<=e.indexOf('${'))){e=e.split('|').map((e)=>e.split(','));for(let t of e)$N('circle',{r:4,cx:l(+t[0]),cy:m(+t[1])},_)}}let s=this.children[0],n=this.attr('x').split(' ').map((e)=>+e),i=n[0],o=n[1],r=n[2],l=(e)=>600*(e-i)/(o-i),d=(e)=>i+e*(o-i)/600,p=this.attr('x-suffix')||'',c=this.attr('y').split(' ').map((e)=>+e),h=c[0],g=c[1],u=c[2],m=(e)=>400*(g-e)/(g-h),f=this.attr('y-suffix')||'',v=$N('g',{},s),y=$N('g',{class:'series'},s),$=$N('g',{class:'axesF'},s),x=$N('g',{class:'foreground'},s);for(let e=h+u;e<g;e+=u)if($N('line',{x1:0,x2:596,y1:m(e),y2:m(e),class:'axis'},e?v:$),e){$N('line',{x1:l(0),x2:l(0)-4,y1:m(e),y2:m(e)},$);for(let t of['outline',''])$N('text',{html:e+f,class:t,x:l(0),y:m(e),dy:4,dx:-8,"text-anchor":'end'},$)}for(let e=i+r;e<o;e+=r)if($N('line',{x1:l(e),x2:l(e),y1:396,y2:0,class:'axis'},e?v:$),e){$N('line',{x1:l(e),x2:l(e),y1:m(0),y2:m(0)+4},$);for(let t of['outline',''])$N('text',{html:e+p,class:t,x:l(e),y:m(0),dy:18,"text-anchor":'middle'},$)}let b=this.hasAttr('crosshairs');t(this.attr('fn')),this.on('attr:fn',(a)=>t(a.newAttr));let w=this.attr('regions');w=w?w.split('|'):[];for(let e,t=0;t<w.length;++t)e=w[t].split(';').map((e)=>e.split(',').map((e)=>+e)),$N('rect',{class:'region r'+(t+1),x:l(e[0][0]),y:m(e[0][1]),width:l(e[1][0])-l(e[0][0]),height:m(e[1][1])-m(e[0][1])},s);let _=$N('g',{class:'points'},s);a(this.attr('points')),this.on('attr:points',(t)=>a(t.newAttr))}}registerElement('x-coordinate-system',CoordinateSystem,{templateId:'#coordinate-system'});class CoordinateSketch extends CustomElement{ready(){let e=600,t=400,a=this.$('svg'),s=a.$('.axes'),n=a.$('.validation'),i=(t)=>t+e/2,o=(e)=>t/2-e,r=this.attr('validate');r&&(r=r.split(':'));for(let a=50-t/2;a<t/2;a+=50)$N('line',{x1:0,x2:e,y1:o(a),y2:o(a),class:a?'axis':'axis primary'},s);for(let a=50-e/2;a<e/2;a+=50)$N('line',{x1:i(a),x2:i(a),y1:t,y2:0,class:a?'axis':'axis primary'},s)}}registerElement('x-coordinate-sketch',CoordinateSketch,{templateId:'#coordinate-sketch'});const MESSAGES={SyntaxError:'This expression is not valid. ',EvalError:''},FN_NAMES={"+":'addition',"*":'multiplication',"/":'fractions or division',"-":'subtraction',sqrt:'square roots',"^":'powers'};class Equation extends CustomElement{ready(){let e=this.$('.input'),t=this.$('.error'),a=words(this.attr('vars')),s=words(this.attr('fns')),n=null;const i=()=>{clean$1(e);let t=this.props.validate,i=validate(e,a,s,t);'error'in i?n=i.error:(n=null,e.removeAttr('contenteditable'),e.addClass('done'),this.trigger('solve',i))};this.$$('.key').forEach((e)=>{e.on('pointerdown',(t)=>{t.preventDefault()}),e.on('pointerup',()=>{keyclick(e.data.type,i)})}),e.on('keydown',(t)=>{keydown(t,i)}),e.on('focus',()=>{n&&t.exit('pop')}),e.on('blur',()=>{n&&(t.$('svg').trigger('setTooltip',n),t.enter('pop'),this.trigger('message',n))})}}registerElement('x-equation',Equation,{templateId:'#equation'});class EquationSystem extends CustomElement{ready(){let e=this.$('table'),t=e.$('tr:last-child').html;const a=({expr:n,final:i})=>{if(i)return this.trigger('complete');let o=s,r=$N('tr',{html:t},e);s=r.$('x-equation'),s.on('solve',a),s.$('[contenteditable]').focus(),s.props.validate=function(e){return e.same(n)?{error:'You\u2019ve already had this before.'}:o.props.validate(e)}};let s=this.$('x-equation');s.on('solve',a)}}registerElement('x-equation-system',EquationSystem);class Gallery extends CustomElement{ready(){function e(e){A=e,c.translateX(e),l.trigger('move',e)}function t(e){C=e,m.forEach(function(t,a){t.setClass('on',a>=e&&a<e+v)}),h.setClass('disabled',e===_-v),g.setClass('disabled',0===e),l.trigger('change',e)}function a(){f=d.width,v=k?Math.ceil(f/k):1,y=f/v,p.forEach(function(e){e.css('width',y+'px')}),c.css('width',_*y+'px'),e(-C*y),t(C)}function s(){x=Date.now()-w,e($+b*ease(T,x/E))}function n(){!S&&x<E&&requestAnimationFrame(n),s()}function i(e){S=!1,x=0,$=A,b=-e*y-A,w=Date.now(),t(e),n()}function o(){T='quad',C<_-v&&i(C+1)}function r(){T='quad',0<C&&i(C-1)}const l=this;this.parents('x-step')[0].css('overflow','hidden');const d=this.$('.wrapper'),c=this.$('.panel'),p=c.children,h=this.$('.next'),g=this.$('.back'),u=this.$('.dots'),m=p.map(()=>$N('div',{class:'dot'},u));let f,v,y,x,$,b,w,_=p.length,k=this.attr('slide-width')||null,C=0,A=0,T='quad',E=500,S=!1;h.on('click',o),g.on('click',r);let I=null,P=null,L=null,M=null;slide(d,{start(e){S=!0,I=A,P=e.x,M=L=P},move(t){L=M,M=t.x;let a=I-P+t.x,s=-(_-v)*y,n=0<a?a/4:a<s?s+(a-s)/4:a;e(n),l.css('pointer-events','none')},end(){let e=M-L,t=12<e?1:-12>e?-1:0;T='quad-out',i(clamp(_Mathround(-A/y-t),0,_-v)),setTimeout(()=>l.css('pointer-events','auto'))}}),Browser.resize(a),this.goNext=o,this.goBack=r}}registerElement('x-gallery',Gallery,{templateId:'#gallery'});class Gameplay extends CustomElement{ready(){this.playing=!1,this.completed=!1,this.addClass('paused');let e=this.$('.slide-template');this.slideTemplate=e.html,e.remove(),this.$progress=this.$('.progress'),this.time=+this.attr('time')||8e3,this.slideGenerator=noop,this.$currentSlide=null,this.currentAnimation=null,this.$dots=this.$('.dots'),this.goal=(this.attr('goal')||'6/8').split('/').map((e)=>+e),this.$dots.css('margin-left',-8*this.goal[1]+'px');for(let e=0;e<this.goal[1];++e)$N('div',{class:'dot'},this.$dots);this.history=[],this.$('.toggle').on('click',()=>{this[this.playing?'pause':'play']()})}score(e){if(this.$dots.children[this.history.length].addClass(e?'green':'red'),this.history.push(e),!this.completed&&total(this.history)>=this.goal[0])return this.completed=!0,this.$('x-solved').enter(),this.trigger('score'),this.pause(),!0}makeSlide(){function e(t){a.trigger('error',t),n(!1)}if(!this.playing)return;if(this.history.length>=this.goal[1]){this.history.shift(),this.$dots.animate({transform:['none','translateX(-16px)']},300).then(()=>{this.$dots.css('transform','none')});let e=this.$dots.children[0];e.exit('fade',300).then(()=>{e.remove()});let t=$N('div',{class:'dot'},this.$dots);t.enter('fade',300)}if(this.$currentSlide){let e=this.$currentSlide;e.animate({transform:['none','translateX(-100%)']},400).then(()=>{e.remove()})}let a=$N('div',{class:'slide',html:this.slideTemplate},this);a.animate({transform:['translateX(100%)','none']},400);let s=this.time*(1-total(this.history)/this.goal[1]/2),t=this.$progress.animate({width:['100%','0%']},s,400,'linear');const n=(e)=>{a.addClass('done');let s=this.score(e);t.cancel(),s||setTimeout(()=>this.makeSlide(),1e3)};t.then(e),this.$currentSlide=a,this.currentAnimation=t,this.slideGenerator(a,function(t){a.trigger('success',t),n(!0)},e)}setFirstSlide(e){this.$currentSlide=$N('div',{class:'slide',html:this.slideTemplate},this),e(this.$currentSlide)}play(){this.playing||(this.playing=!0,this.removeClass('paused'),this.makeSlide(),this.$('x-solved').hide())}pause(){this.playing&&(this.playing=!1,this.currentAnimation.cancel(),this.addClass('paused'))}}registerElement('x-gameplay',Gameplay,{templateId:'#gameplay'});class GeoElement{constructor(e,t,a,s){this.x=t,this.name=s||e.model.name(),this.$geopad=e,this.removed=!1,this.$el=a||this.makeEl(),e.elements.set(this.name,this),this.$el.hasAttr('label')&&this.setLabel(this.$el.attr('label')),this.val=t(e.model),this.val&&e.model.set(this.name,this.val),e.model.watch((e)=>{if(!this.removed&&(this.val=this.x(e),this.$el.setClass('hidden',!this.val),(this.val||this.name in e)&&(e[this.name]=this.val),!!this.val)){const t=this.val.transform(this.$geopad.grid);this.update(t),this.$label&&this.updateLabel(e,t)}})}setLabel(e,t=null,a=null){this.$label||(this.$label=makeLabel(this.$el,this.$geopad,t)),this.labelStr=parse(e),this.labelPosition=a?parse(a,!0):null}updateLabel(e,t){if(this.$label.text=this.labelStr(e),this.labelPosition){const t=this.labelPosition(e);this.$label.transform=`translate(${t.x}px, ${t.y+5}px)`}else this.$label.transform=labelPosn(t,this.$el,this.$geopad)}remove(e=400){this.$label&&this.$label.exit(),this.exit(e).then(()=>{this.$geopad.elements.delete(this.name),this.removed=!0})}}class GeoPath extends GeoElement{constructor(e,t,a,s){super(e,t,a,s),this.points=[]}update(e){try{this.$el.setAttr('d',draw(e,this.$el,this.$geopad))}catch(t){this.$el.setAttr('d','')}}makeEl(){return $N('path',{},this.$geopad.$paths)}exit(e){return this.$el.exit('draw',e)}}class GeoPoint extends GeoElement{makeEl(){return $N('circle',{r:4},this.$geopad.$points)}exit(e){return this.$el.exit('pop',e)}update(e){this.$el.setCenter(e),this.$halo&&this.$halo.setCenter(e)}addHalo(){this.$halo=$N('circle',{class:'halo',r:18},this.$geopad.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter('pop')}removeHalo(){this.$halo&&this.$halo.exit('pop').then(()=>{this.$halo.remove(),this.$halo=null})}}class GeoMovablePoint extends GeoPoint{constructor(e,t,a,s,n){let i=!0;const o=(e)=>{const a=i?t:e[this.name];return n?n(e).project(a):a};super(e,o,a,s),i=!1,this.$el.hasClass('pulsate')&&this.pulsate(),this.project=(t)=>{n=t,e.model.update()},this.locked=!1}pulsate(){this.$pulse=$N('circle',{class:'pulse',r:8},this.$geopad.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one('mouseover pointerdown',()=>this.$pulse.remove())}lock(){this.$el.removeClass('move'),this.$el.setAttr('r',4),this.locked=!0}makeEl(){return $N('circle',{class:'move',r:8},this.$geopad.$points)}}class GeoTool{constructor(e){this.$geopad=e,this.startPoint=null,this.endPosn=null,this.pending=null}start(){}move(){}end(){}click(){}cancel(){}addMovablePoint(e){if(this.$geopad.noPoints)return{val:e};const t=new GeoMovablePoint(this.$geopad,e);return this.$geopad.trigger('add:point',t),t}}class MoveTool extends GeoTool{start(e){e&&e instanceof GeoMovablePoint&&!e.locked&&(this.startPoint=e)}move(e,t){this.startPoint&&!this.startPoint.val.equals(t)&&this.$geopad.model.set(this.startPoint.name,t)}end(){this.startPoint=null,this.$geopad.trigger('moveEnd',this.startPoint)}}class PointTool extends MoveTool{click(e,t){e||this.addMovablePoint(t)}}class DrawTool extends GeoTool{constructor(e){super(e),this.clicked=!1}start(e,t){if(!this.pending){this.startPoint=e||this.addMovablePoint(t),this.endPosn=this.startPoint.val;this.pending=new GeoPath(this.$geopad,()=>this.constructor.path(this.startPoint.val,this.endPosn)),this.pending.$el.addClass('thin'),this.$geopad.trigger('begin:path',this.pending)}}move(e,t){this.pending&&(this.endPosn=e?e.val:t,this.$geopad.model.update())}end(e,t){if(!this.pending)return;if(e===this.startPoint)return this.cancel();const a=this.pending;a.points=[this.startPoint,e||this.addMovablePoint(t)],a.$el.removeClass('thin'),a.x=()=>this.constructor.path(a.points[0].val,a.points[1].val),this.$geopad.model.update(),this.$geopad.trigger('add:path',a),this.startPoint=this.endPosn=this.pending=null,this.clicked=!1}click(e,t){return this.pending?this.clicked?void this.end(e,t):this.clicked=!0:void 0}hover(e,t){this.pending&&this.move(e,t)}cancel(){this.pending&&this.pending.remove(),this.startPoint=this.endPosn=this.pending=null,this.clicked=!1}}class LineTool extends DrawTool{static path(e,t){return new Segment(e,t)}}class CircleTool extends DrawTool{static path(e,t){const a=Point.distance(e,t);return new Circle(e,a)}}class RectangleTool extends DrawTool{static path(e,t){return new Rectangle(e,t.x-e.x,t.y-e.y)}}class PerpBisectorTool extends DrawTool{static path(e,t){return new Segment(e,t).perpBisector}}class AngleBisectorTool extends GeoTool{click(e,t){if(e||(e=this.addMovablePoint(t)),!this.startPoint)this.startPoint=[e],e.addHalo();else if(1===this.startPoint.length){this.startPoint.push(e),e.addHalo(),this.endPosn=e.val;this.pending=new GeoPath(this.$geopad,()=>new Angle(this.startPoint[0].val,this.startPoint[1].val,this.endPosn).bisector),this.$geopad.trigger('begin:path',this.pending)}else if(2===this.startPoint.length){const t=[...this.startPoint,e];this.pending.$el.removeClass('thin'),this.pending.x=()=>new Angle(...t.map((e)=>e.val)).bisector,this.$geopad.model.update(),this.$geopad.trigger('add:path',this.pending);for(let e of this.startPoint)e.removeHalo();this.startPoint=this.endPosn=this.pending=null}}hover(e,t){this.pending&&(this.endPosn=e?e.val:t,this.$geopad.model.update())}cancel(){if(this.pending){this.pending.remove();for(let e of this.startPoint)e.removeHalo()}this.startPoint=this.endPosn=this.pending=null}}const COMPASS='M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z',RULER='M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z',MODEL_FUNCTIONS={pi:_MathPI,point:(e,t)=>new Point(e,t),angle:(e,t,a)=>new Angle(e,t,a),line:(e,t)=>new Line(e,t),ray:(e,t)=>new Ray(e,t),segment:(e,t)=>new Segment(e,t),circle:(e,t)=>new Circle(e,t),arc:(e,t,a)=>new Arc(e,t,a),polygon:(...e)=>new Polygon(...e),polyline:(...e)=>new Polyline(...e),triangle:(e,t,a)=>new Triangle(e,t,a),rectangle:(e,t,a,s)=>new Rectangle(e,t,a,s),distance:Point.distance,round:(e,t=0)=>_round(e,t),intersections};class Geopad extends CustomElement{ready(){function t(t){return t.clamp(5,e-5,5,a-5).transform(n).round()}const e=this.attr('width')||this.width,a=this.attr('height')||e;this.box=new Rectangle(new Point(0,0),e,a).polygon,this.css({width:e+'px',height:a+'px'}),this.hasClass('sticky')&&this.css('top',`calc(50vh - ${a/2}px)`),this.$svg=this.children.filter((e)=>'SVG'===e.tagName)[0],this.model=this.getModel(),this.model.assign(MODEL_FUNCTIONS),this.elements=new Map,this.findIntersections=this.hasAttr('intersect'),this.noPoints=this.hasAttr('no-points'),this.cachedIntersections=null,this.model.watch(()=>this.cachedIntersections=null);const s=+this.attr('grid')||null,n=s?[[1/s,0,-.5],[0,1/s,-.5]]:null;if(this.grid=s?[[s,0,s/2],[0,s,s/2]]:null,s){const t=$N('g',{class:'grid'},this.$svg);for(let n=s/2;n<e;n+=s)$N('line',{x1:n,x2:n,y1:0,y2:a},t);for(let n=s/2;n<a;n+=s)$N('line',{x1:0,x2:e,y1:n,y2:n},t)}this.$paths=$N('g',{class:'paths'},this.$svg),this.$pulses=$N('g',{class:'pulses'},this.$svg),this.$points=$N('g',{class:'points'},this.$svg),this.$labels=$N('g',{class:'labels'},this.$svg);for(const e of this.$svg.$$('path[x], circle')){const t=e.hasAttr('x')?parse(e.attr('x'),!0):null,a=e.hasAttr('project')?parse(e.attr('project'),!0):null,s=e.attr('name')||this.model.name();'PATH'===e.tagName?(e.moveTo(this.$paths),new GeoPath(this,t,e,s)):(e.moveTo(this.$points),e.hasClass('move')?(e.setAttr('r',8),new GeoMovablePoint(this,e.center,e,s,a)):t&&(e.setAttr('r',4),new GeoPoint(this,t,e,s)))}const i={move:new MoveTool(this),point:new PointTool(this),line:new LineTool(this),circle:new CircleTool(this),perpBisector:new PerpBisectorTool(this),angleBisector:new AngleBisectorTool(this),rectangle:new RectangleTool(this)};this.$tools=this.$('.tools');let o=i[this.$tools.$active.data.tool];this.$tools.on('change',(e)=>o=i[e.data.tool]),slide(this.$svg,{start:(e)=>o.start(this.vertexAt(e),t(e)),move:(e)=>o.move(this.vertexAt(e),t(e)),end:(e,a)=>{const s=10>Point.distance(e,a)?'click':'end';o[s](this.vertexAt(e),t(e))}}),this.$svg.on('mousemove',(a)=>{if(o.hover){const e=svgPointerPosn(a,this.$svg);o.hover(this.vertexAt(e),t(e))}}),Browser.onKey('escape',()=>o.cancel())}eval(e){return parse(e,!0)(this.model)}get points(){const e=Array.from(this.elements.values());return e.filter((t)=>t instanceof GeoPoint&&t.val&&!t.removed)}get paths(){const e=Array.from(this.elements.values());return e.filter((t)=>t instanceof GeoPath&&t.val&&!t.removed)}get intersections(){if(!this.findIntersections)return[];if(this.cachedIntersections)return this.cachedIntersections;const e=this.paths,t=[];for(let a of e)for(let s of e){if(a===s)continue;const e=intersections(a.val,s.val);for(let n=0;n<e.length;++n){const i=()=>intersections(a.val,s.val)[n];t.push({val:e[n],x:i})}}return this.cachedIntersections=t,t}vertexAt(e){let t=null,a=Infinity,s=this.grid?this.grid[0][0]/2:20;for(let n of[...this.points,...this.intersections]){const i=Point.distance(e,n.val.transform(this.grid));i<s&&i<a-1&&(a=i,t=n)}return t instanceof GeoPoint?t:t?this.drawPoint(t.x,{animate:!1}):void 0}setActiveTool(e){this.$tools.makeActive(this.$(`.tool[data-tool="${e}"]`))}drawPath(e,{classes:t='',animate:a=0,target:s='',name:n=''}={}){const i=$N('path',{class:t,target:s},this.$paths);isString(e)&&(e=parse(e,!0));const o=new GeoPath(this,e,i,n);return a&&i.enter(i.hasClass('fill')?'fade':'draw',a),o}drawPoint(e,{classes:t='',animate:a=!0,target:s='',name:n=''}={}){const i=$N('circle',{r:4,class:t,target:s},this.$points);isString(e)&&(e=parse(e,!0));const o=new GeoPoint(this,e,i,n);return a&&i.enter('pop'),o}drawMovablePoint(e,{classes:t='',animate:a=!0,target:s='',name:n=''}={}){const i=$N('circle',{r:4,class:t,target:s},this.$points),o=new GeoMovablePoint(this,e,i,n);return a&&i.enter('pop'),o}animatePoint(e,t,a=400){const s=new Line(this.model[e],t);animate((t)=>this.model.set(e,s.at(t)),a)}animateConstruction(e,t=2e3){let a=this.elements.get(e),s=a.val;if(s instanceof Circle&&(s=s.arc),s instanceof Line){this.$ruler||(this.$ruler=$N('path',{d:RULER,class:'sketch'},this.$svg));const e=getToolTransform(s.at(-.1),12,s.angle-.3,1.2*s.length),n=getToolTransform(s.at(-.1),12,s.angle,1.2*s.length);return this.$ruler.show(),a.$el.hide(),this.$ruler.animate({opacity:[0,1],transform:[e,n]},500).then(()=>a.$el.enter('draw',t)).then(()=>this.$ruler.animate({opacity:[1,0],transform:[n,e]},500))}if(s instanceof Arc){this.$compass||(this.$compass=$N('path',{d:COMPASS,class:'sketch'},this.$svg));const e=getToolTransform(s.c,50,s.startAngle,1.5*s.radius),n=getToolTransform(s.c,50,s.startAngle,s.radius),i=getToolTransform(s.c,50,s.startAngle+s.angle,s.radius),o=getToolTransform(s.c,50,s.startAngle+s.angle,1.5*s.radius);return this.$compass.show(),a.$el.hide(),this.$compass.animate({opacity:[0,1],transform:[e,n]},500).then(()=>(a.$el.enter('draw',t),this.$compass.animate({transform:[n,i]},t,0,'linear'))).then(()=>this.$compass.animate({opacity:[1,0],transform:[i,o]},500))}}showGesture(e,t){this.$gesture||(this.$gesture=$N('x-gesture',{},this)),this.$gesture.stop(),e=parse(e,!0)(this.model),this.$gesture.from=e,t?(t=parse(t,!0)(this.model),this.$gesture.start(t.subtract(e))):this.$gesture.start(),this.one('click mouseover pointerdown',()=>this.$gesture.stop())}waitForPath(e){const t=defer(),a=()=>{for(let s of this.paths)if(e(s))return t.resolve(s),void this.off('add:path moveEnd',a)};return this.on('add:path moveEnd',a),t.promise}waitForPaths(e,{onCorrect:t,onIncorrect:a,onHint:s,onComplete:n,maxErrors:o=4}){const r=e.map((e)=>isString(e)?parse(e,!0):()=>e),l=tabulate(!1,e.length);let d=0,c=!1;this.on('add:path',(e)=>{if(!c){const p=r.findIndex((t)=>t(this.model).equals(e.val));if(0<=p)return l[p]?e.remove(0):(l[p]=!0,t&&t(e,p),d=0,void(l.every((e)=>e)&&(c=!0,n&&n(!1))));if(e.remove(),!(1>e.val.length))if(d+=1,d>=o){const e=l.findIndex((e)=>!e),t=this.drawPath(r[e],{animate:1e3});l[e]=!0,s&&s(t,e),d=0,l.every((e)=>e)&&(c=!0,n&&n(!0))}else a&&a(e)}})}}registerElement('x-geopad',Geopad,{templateId:'#geopad',model:!0});class Gesture extends CustomElement{created(){this.doAnimation=!1,this.from=null;const e=this.attr('slide');this.slide=e?new Point(...e.split(',').map((e)=>+e)):null}ready(){this.$target=$(this.attr('target')),this.$target&&this.$target.on('click mouseover pointerdown',()=>this.stop())}start(e){this.doAnimation||(this.doAnimation=!0,e||this.slide?this._runSlideAnimation(e||this.slide):this._runClickAnimation())}stop(){this.doAnimation=!1}_getPosition(){const e=this.$target.positionLeft-this.positionLeft+this.$target.width/2,t=this.$target.positionTop-this.positionTop+this.$target.height/2;return{x:e,y:t}}_runSlideAnimation(e){this.show();const t=this.from||this._getPosition(),a=`translate(${t.x-15}px,${t.y-10}px)`,s=`translate(${t.x+e.x-15}px,${t.y+e.y-10}px)`;this.animate({transform:[a+' scale(2)',a],opacity:[0,1]},300).then(()=>this.animate({transform:[a,s]},1e3)).then(()=>this.animate({transform:[s,s+' scale(2)'],opacity:[1,0]},300)).then(()=>{this.hide(),setTimeout(()=>{this.doAnimation&&this._runSlideAnimation(e)},1e3)})}_runClickAnimation(){this.show();const e=this.from||this._getPosition(),t=`translate(${e.x-15}px,${e.y-10}px)`;this.animate({transform:[t+' scale(2)',t],opacity:[0,1]},500).then(()=>this.animate({transform:[t,t+' scale(2)'],opacity:[1,0]},500,200)).then(()=>{this.hide(),setTimeout(()=>{this.doAnimation&&this._runClickAnimation()},1e3)})}}registerElement('x-gesture',Gesture,{templateId:'#gesture'});const glossary=JSON.parse($('#glossary').text),bios=JSON.parse($('#bios').text),$overlay=$N('div',{class:'gloss-overlay'},$body),$floatingWrap=$N('div',{class:'gloss-floating-wrap'},$body),$floating=$N('div',{class:'gloss-floating'},$floatingWrap);let activeGloss=null;Browser.resize(()=>{activeGloss&&activeGloss.hide()});class Gloss extends CustomElement{ready(){this.xid=this.attr('xid'),this.$target=this.$('.target'),this.$popup=this.$('.popup'),this.$popup.html=this.body(),this.on('hover',{enter:()=>this.show(),exit:()=>this.hide(),delay:100,$clickTarget:this.$target})}show(){if(activeGloss=this,this.addClass('on'),600>=Browser.width)$floating.html=this.body(),$floatingWrap.enter('pop',300),$overlay.enter('fade',300);else{const e=this.$target.bounds,t=this.$popup.width,a=this.$popup.height;this.setClass('left',e.left+t>Browser.width-15),this.setClass('top',e.top+e.height+a>Browser.height-10)}}hide(){activeGloss=null,this.removeClass('on'),600>=Browser.width&&($floatingWrap.exit('pop',300),$overlay.exit('fade',300))}body(){const e=glossary[this.xid];if(!e)return console.error('missing gloss:',this.xid),'';const t=e.image?`<img class="gloss-img" src="/resources/shared/glossary/${e.image}"/>`:'';return e.text+t}}class Bio extends Gloss{body(){const e=`<img class="bio-img" src="/resources/shared/bios/${this.xid}.jpg"/>`;return e+(bios[this.xid]||{}).bio}}registerElement('x-gloss',Gloss,{templateId:'#gloss'}),registerElement('x-bio',Bio,{templateId:'#gloss'});class Slider extends CustomElement{ready(){this.steps=+this.attr('steps'),this.current=0,this.cancelled=!1;const e=$N('div',{class:'knob'},this);this.draggable=new Draggable(e,this,'x',4),this.draggable.on('start',()=>this.cancelled=!0),this.draggable.on('click',()=>this.play()),this.draggable.on('move',(t)=>{const e=_Mathfloor(t.x/this.draggable.width*this.steps);e!==this.current&&this.trigger('move',e),this.current=e}),this.on('attr:steps',(t)=>this.steps=+t.newAttr)}play(){this.cancelled=!1;const e=()=>{let t=this.draggable.position.x;!this.cancelled&&t<this.draggable.width&&window.requestAnimationFrame(e),this.draggable.position={x:t+2,y:0}};e()}set(e){this.draggable.position={x:e*this.draggable.width/this.steps,y:0}}}registerElement('x-slider',Slider,{attributes:['steps']});class ImgSequence extends CustomElement{ready(){let e=this.attr('src'),t=+this.attr('pages')-1,a={width:this.attr('width'),height:this.attr('height')},s=$N('img',a,this),n=$N('x-slider',{steps:t},this),i=tabulate(()=>new Image,t);i.forEach((t,a)=>{t.src=e.replace('#',a)});const o=(a)=>{s.setAttr('src',e.replace('#',a)),a===t&&this.trigger('last')};n.on('move',o),o(0)}}registerElement('x-img-sequence',ImgSequence);let isOpen=!1,transform={},$activeImg=null;const $lightbox=$N('div',{class:'lightbox-overlay'},$body),$lightboxImg=$N('div',{class:'lightbox-img'},$lightbox);$lightbox.on('click',closeLightbox),Browser.onKey('escape',closeLightbox),$lightbox.on('scrollwheel touchmove',function(t){t.preventDefault(),t.stopPropagation()}),Browser.onKey('space up down left right pagedown pageup',function(t){isOpen&&(t.preventDefault(),t.stopPropagation())});class Media extends CustomElement{ready(){let e=this.attr('src'),t=e.slice(-3),a=this.$('.wrap');const s=this.attr('width'),n=this.attr('height');this.css('width',s+'px'),a.css('padding-bottom',100*(+n/+s)+'%');let i,o=a.$('.credit'),r=a.$('.play'),l=a.$('.zoom');if(isOneOf(t,'mp4','ogg'))i=$N('video',{poster:e.replace(/mp4$/,'jpg'),src:e}),i._el.preload=!0,i._el.loop=!0,i._el.muted=!0,i.setAttr('muted','true'),i.setAttr('playsinline','true'),i.on('mouseover touchdown',function(){i._el.play()}),i.on('mouseout touchup',function(){i._el.pause()}),this.addClass('interactive');else if('gif'===t){let t=e.replace(/gif$/,'png'),a=new Image;a.src=e,i=$N('img',{src:t}),i.on('mouseover touchdown',()=>{i.setAttr('src',e)}),i.on('mouseout touchup',()=>{i.setAttr('src',t)}),this.addClass('interactive')}else i=$N('img',{src:e}),r.remove();a.prepend(i);let d=this.attr('credit');if(d?o.text=d:o.remove(),this.hasAttr('lightbox')){this.addClass('interactive');let t=e.replace(/\.(?=[^.]*$)/,'-large.');this.on('click',()=>{openLightbox(this,e,t)})}else l.remove()}}registerElement('x-media',Media,{templateId:'#media'});class Notepad extends CustomElement{ready(){function e({x:e,y:t}){let s=$N('div',{contenteditable:'True'},a);s.css('left',e-6+'px'),s.css('top',t-26+'px'),s.focus(),n=s,s.on('blur',function(){s.text||s.remove()})}function t(e,t){if(!i){let e=$N('g',{},s);$N('line',{x1:t.x,y1:t.y,class:'stroke'},e),$N('line',{x1:t.x,y1:t.y,class:'halo'},e),e.on('pointerdown',function(){i=o=e,e.addClass('selected')}),e.on('clickAway',function(){e.removeClass('selected')}),i=e}i.children.forEach((t)=>{t.setAttr('x2',e.x),t.setAttr('y2',e.y)})}let a=this.$('.text'),s=this.$('svg'),n=null,i=null,o=null;slide(s,{start:function(){n&&n.blur(),n=i=null},move:function(e,a){o||(10<Point.distance(a,e)?t(e,a):i&&(i.remove(),i=null))},end:function(t,a){!o&&10>Point.distance(a,t)&&e(t),o=null}})}}registerElement('x-notepad',Notepad,{template:'<div class="text"></div><svg></svg>'});class Parallax extends CustomElement{ready(){function e(i){if(i.top>=t&&i.top<=a){let e=(i.top-t)/(a-t);s.transform='translateY('+e*(n?50:33)+'%)'}}let t,a,s=this.$('.image'),n=50>this.positionTop;s.css({"background-image":`url("${this.attr('background')}")`,height:n?'100%':'150%'});const i=({height:e})=>{let s=this.positionTop;t=_Mathmax(0,s-e),a=s+this.height};Browser.resize(i),$body.on('scroll',e)}}registerElement('x-parallax',Parallax,{templateId:'#parallax'});class Picker extends CustomElement{ready(){const e=this.getModel().$step;let t=0,a=0;this.children.forEach((s,n)=>{s.data.error||(e.goals.push('picker-'+n),t+=1),s.one('click',()=>{e.addHint(s.data.error?s.data.error:'correct'),s.addClass(s.data.error?'incorrect':'correct'),s.data.error||(e.score('picker-'+n),a+=1,t==a&&this.addClass('solved'))})})}}registerElement('x-picker',Picker);const MARGIN=15,MARGIN_TOP=100;class Popup extends CustomElement{ready(){this.isOpen=!1,this.$target=this.$('.target'),this.$box=this.$('.popup'),this.$bubble=this.$('.body'),this.$container=$(this.attr('container'))||$body;const e=()=>{this.isOpen?this.close():this.open()},t=()=>this.close();this.$target.on('click',e),this.on('clickOutside',t),this.clear=function(){this.$target.off('click',e),this.off('clickOutside',t)},this.on('detached',()=>this.close())}open(){if(!this.isOpen){this.isOpen=!0,this.$box.show();let e=this.$bubble.bounds,t=e.top-e.height,a=e.left-e.width/2,s=e.right+e.width/2,n=this.$container.offsetLeft;a<n+MARGIN&&this.$bubble.translateX(n+MARGIN-a);let i=n+this.$container.width;s>i-MARGIN&&this.$bubble.translateX(i-MARGIN-s),Browser.redraw(),t<MARGIN_TOP&&$body.scrollBy(t-MARGIN_TOP),this.$target.addClass('on'),this.$box.addClass('on')}}close(){this.isOpen&&(this.isOpen=!1,this.$target.removeClass('on'),this.$box.removeClass('on'),setTimeout(()=>this.$box.hide(),200))}}registerElement('x-popup',Popup,{templateId:'#popup'});class Progress extends CustomElement{ready(){let t=+this.attr('r')||10,a=this.attr('colour');const s=this.children[0];s.setAttr('width',2*t+2),s.setAttr('height',2*t+2),draw$1(s,t,+this.attr('p')||0,a),this.on('attr:p',(n)=>draw$1(s,t,n.newVal,a))}}registerElement('x-progress',Progress,{template:'<svg></svg>',attributes:['p']});class Slideshow extends CustomElement{ready(){let e=this.$$('.slide').length,t=this.$(e?'.stage-box':'.legend-box'),a=this.$(e?'.slides-wrap':'.legend-wrap'),s=this.$$(e?'.slide':'.legend');this.length=s.length,this.current=0;let n=s.map((e)=>words(e.data.needs||''));this.isReady=function(e){let t=n[this.current+1]||[];return t.every((t)=>e.scores.has(t))};let i=this.$('.nav');e||i.addClass('inverse'),e&&this.$('.legend-box').hide();let o,r=this.$('.back'),l=this.$('.next'),d=list(this.length).map(()=>$N('div',{class:'dot'},this.$('.dots')));Browser.resize(()=>{o=this.width,s.forEach((e)=>{e.css('width',o+'px')}),t.css('height',s[this.current].height+'px'),a.css('width',this.length*o+'px'),a.translateX(-this.current*o)}),this.go=(e)=>!!s[this.current+e]&&(s[this.current].removeClass('on'),d[this.current].removeClass('on'),this.current+=e,s[this.current].addClass('on'),d[this.current].addClass('on'),t.css('height',s[this.current].height+'px'),a.translateX(-this.current*o),r.setClass('disabled',0===this.current),l.setClass('disabled',this.current===this.length-1),this.trigger(1===e?'next':'back',this.current),this.trigger('step',this.current),!0),r.on('click',()=>{this.go(-1)}),l.on('click',()=>{this.go(1)}),s[0].addClass('on'),d[0].addClass('on'),r.addClass('disabled')}goNext(){return this.go(1)}goBack(){return this.go(-1)}}registerElement('x-slideshow',Slideshow,{templateId:'#slideshow'});const colours=loop(Colour.rainbow(8)),images=loop(['badge','homework','laurels','lightbulb','owl','scroll','trophy']);class Solved extends CustomElement{ready(){this.visible=!1,this.$svg=this.$('use'),this.$text=this.$('.message'),this.$step=this.getModel().$step,this.on('click',()=>this.exit())}enter(){if(!this.visible){this.visible=!0;const e=this.$step.addHint('correct'),t=colours(),a=images();this.css('background-color',t),this.$text.text=e.text.replace(/<.*>/,''),this.$svg.setAttr('xlink:href','/sketch.svg#'+a),Browser.replaceSvgImports(),enter(this,'pop',300,600)}}exit(){this.visible&&(this.visible=!1,exit(this,'pop',300))}}registerElement('x-solved',Solved,{templateId:'#solved'});class Sortable extends CustomElement{ready(){this.items=this.children.map((e)=>new Draggable(e,this,'y',0,!0));const e=(e=null)=>{let t=cumulative(this.items.map((e)=>e.h+10));this.items.forEach(function(a,s){a!==e&&(a.position={y:t[s-1]||0})})},t=()=>this.items.every((e,t)=>+e.$el.data.index===t)||this.items.every((e,t)=>+e.$el.data.index==this.items.length-t-1);for(let a of this.items)a.on('drag',()=>{this.items=sortByFn(this.items,(e)=>e.position.y-(e===a?10:0)),e(a)}),a.on('end',()=>{e(),t()&&this.solve()});Browser.resize(()=>{for(let e of this.items)e.h=e.$el.height;const t=total(this.items.map((e)=>e.h));this.css('height',t+10*this.items.length-10+'px'),e()})}solve(){this.trigger('solve'),this.addClass('solved');for(let e of this.items)e.disabled=!0}}registerElement('x-sortable',Sortable);class Tabbox extends CustomElement{ready(){const e=this.$('.titles');this.$body=this.$('.body'),this.$tabs=this.$$('.tab'),this.$titles=[],this.active=0;for(let t=0;t<this.$tabs.length;++t){const a=this.$tabs[t].$('h4');e.append(a),this.$titles.push(a),a.on('click',()=>this.makeActive(t))}this.$titles[0].addClass('active'),this.$tabs[0].show()}makeActive(e){if(this.active!==e){this.$titles[this.active].removeClass('active'),this.$titles[e].addClass('active'),this.$tabs[e].show();const t=this.$tabs[e].outerHeight+'px';this.$tabs[e].hide(),this.$tabs[this.active].exit('fade',300),this.$tabs[e].enter('fade',300,300),this.$body.animate({height:t},600).then(()=>this.$body.css('height','auto')),this.active=e}}}const template='<div class="titles"></div><div class="body"><slot></slot></div>';registerElement('x-tabbox',Tabbox,{template});const $fixed=$$('x-toolbox, header, .toast-panel'),$targets=$N('svg',{class:'target-body',style:`position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; pointer-events: none; z-index: 900; opacity: 0;
            transform: translateZ(0); will-change: opacity; transition: opacity .3s;`,html:`<defs>
      <mask id="masking"><rect width="100%" height="100%" fill="white"/></mask>
    </defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z"/>
    </marker>
    <rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" fill="white" opacity="0.9"/>
    <path id="target-arrow" stroke="black" stroke-width="5" marker-end="url(#arrow)" opacity="0.3" stroke-linecap="round"/>`},$body),$mask=$targets.$('mask'),$arrow=$targets.$('#target-arrow');let active$1=!1,$bounds=[];class Target extends CustomElement{ready(){function t(){active$1=!0;let t=$$(o);if(t.length){let a=t[0].hasParent(...$fixed);null==e&&(e=i.hasParent(...$fixed));let s=i.bounds,n=t.map((e)=>e.bounds).filter((e)=>e.width||e.height);if(d=0,!a){let e=_Mathmin(...n.map((e)=>e.top)),t=_Mathmax(...n.map((e)=>e.top+e.height)),a=Browser.height-20-t,s=60-e;d=0>a?a:0<s?s:0}$bounds.forEach((e)=>{e.remove()}),$bounds=[s].concat(n).map(function(t,a){let s=a&&!r?10:4;return $N('rect',{x:t.left-s,y:t.top-s+(a||!e?d:0),width:t.width+2*s,height:t.height+2*s,rx:4,ry:4},$mask)}),$arrow.points=connect(s,n[0],e?0:d,a?0:d)}}function a(){d&&$body.scrollBy(-d,300),$targets.css('display','block'),Browser.redraw(),delay(function(){$targets.css('opacity',1)},d?300:0)}function s(t){if(active$1){let e='mousemove'===t.type||'pointermove'===t.type;e&&40>distance(l,[t.clientX,t.clientY])||(clearTimeout(c),active$1=!1,$targets.css('opacity',0),setTimeout(function(){active$1||$targets.css('display','none')},300),$body.off('mousewheel mousemove touchend touchmove',s),i.off('mouseleave',s))}}function n(){d&&!e?$body.on('mousemove',s):i.on('mouseleave',s),$body.on('mousewheel touchend touchmove',s)}const i=this;let e,o=i.attr('to'),r=i.hasAttr('no-margins'),l=null,d=null,c=null;i.on('mouseenter touchstart',function(s){l=[s.clientX,s.clientY],t(),c=setTimeout(a,d?50:30),n()}),i.on('click',function(t){active$1?(t.handled=!0,s({}),setTimeout(function(){$(o).trigger('click mousedown')})):(active$1=!0,d=0,a(),n())})}}registerElement('x-target',Target);const $tooltip=$N('div',{class:'tooltip'},$body);let show=null;$body.on('scroll',hideTooltip);class Tooltip extends CustomElement{ready(){let e=this.attr('for'),t=e?$(e):this.prev,a=this.attr('class')||'top',s=this.hasAttr('touch'),n=this.text,i=this.attr('delay');null===i&&(i=300),this.remove();t&&(t.on('mouseover'+(s?' touchstart':''),()=>{show||t.hasClass('active')||(show=t,setTimeout(function(){show===t&&showTooltip(t,n,a)},+i))}),t.on('mouseout'+(s?' touchend':''),()=>{show&&(show=null,setTimeout(()=>{show!==t&&hideTooltip()},10))}),t.on('setTooltip',(e)=>{n=e}),!s&&t.on('mouseup',hideTooltip))}}registerElement('x-tooltip',Tooltip);class Variable extends CustomElement{ready(){const e=this,t=e.attr('bind');if(!t)return;let a=t.split('|'),s=a[0],n=a[1],i=a[2],o=i.split(',').map((e)=>+e),r=o[0],l=o[1],d=o[2],c=+n;const p=this.getModel();p.set(s,c),this.$('.content').bindObservable(p);let h=e.$('.progress');h.css('width',116*(+c-r)/(l-r)+'px');let g=0,u=0,m=_Mathsqrt(1e3*(d/(l-r)))+(Browser.isTouch?10:2);slide(e,{start:function(t){g=t.x,u=c,e.addClass('on')},move:function(e){let t=e.x-g,a=roundTo(clamp(u+t/m,r,l),d);a=_round(a,2);a===c||(c=a,p&&p.set(s,c),h.css('width',116*(c-r)/(l-r)+'px'))},end:function(){e.removeClass('on'),e.trigger('slide-end')}})}}registerElement('x-var',Variable,{templateId:'#var',model:!0});class Progressbar extends CustomElement{ready(){function e({top:e}){let t=100*clamp(e/c,0,1);s.css('top',t+'%'),i.css('height',t+'%')}function t(e){let t=c*(e-44)/d,s=h.findIndex((a,e)=>h[e+1]>=t);s!==v&&(l.text=a.$steps[s].section.title),v=s,o.css('top',clamp(e,55,Browser.height-22)+'px');const n=p/c*(Browser.height-60);r.setClass('visible',e-44>n+5)}const a=this.getModel().$chapter,s=this.$('.progressbar-handle'),n=this.$('.progressbar-loaded'),i=this.$('.progressbar-active'),o=this.$('.progressbar-popup'),r=o.$('.icon'),l=o.$('span');navigator.userAgent.match(/iP(ad|hone|od)/g)&&($body.css('background','#242436'),$body.$('.body').css('background','white'));let d=0,c=1,p=0,h=[];a.on('resize',(t)=>{d=this.height,c=t.fullHeight-Browser.height,p=$body.scrollHeight-Browser.height,t.steps.reduce((e,t,a)=>h[a]=e+t,0),h.push(Infinity),n.css('height',100*(p/c)+'%'),e({top:$body.scrollTop})}),$body.on('scroll',e),e({top:$body.scrollTop});let g,u,m=!1,f=a.$('.chapter-body');slide(s,{start:()=>{g=$body.scrollTop,this.addClass('scrolling'),m=!0},move:(e,a)=>{u=c*(e.y-a.y)/d,u=clamp(g+u,0,p)-g,f.translateY(-u),$body.trigger('scroll',{top:g+u}),t(e.y)},end:()=>{f.transform='',$body.scrollTop=g+u,this.removeClass('scrolling'),m=!1}}),this.on('mouseup',function(t){if(!m){let e=(t.clientY-44)/d*c;$body.scrollTo(clamp(e,0,p))}});let v;this.on('mousemove',function(a){t(a.y)})}}registerElement('x-progressbar',Progressbar,{templateId:'#progressbar'});const RESET_MSG='Are you sure you want to clear all your saved progress data? This action cannot be undone.';class Toolbox extends CustomElement{ready(){const t=this.getModel().$chapter;this.active=null,this.closeTimeout=null,this.$buttons=this.$$('.t-button'),this.$panels=this.$$('.t-panel'),this.$buttons.forEach((e,t)=>{e.on('click',()=>{this.active===t?this.close():this.open(t)})}),this.on('clickOutside',()=>{820>Browser.width&&this.close()});let e=this.$('.progress-items');t.sections.forEach((a)=>{const s=$N('div',{class:'item hover progress-item locked'},e),n=$N('x-progress',{class:'progress-icon',colour:'white',r:9},s);$N('p',{html:a.title,class:'ellipsis'},s),$N('div',{class:'progress-connection'},s),s.on('click',()=>{820>Browser.width&&this.close(),t.goToStep(a.$steps[0])}),a.on('show',()=>s.removeClass('locked')),a.on('score',()=>n.setAttr('p',a.progress))}),this.$('.reload').on('click',()=>{window.confirm(RESET_MSG)&&(Router.hash='',location.pathname+='/reset')}),this.$('.textbook-toggle').on('click',()=>{820>Browser.width&&this.close(),Browser.hash='full',t.complete()}),this.$('.tutor-toggle').on('click',()=>{this.close(),setTimeout(()=>{t.Tutor.tutorial(!0)},400)}),this.$hints=this.$('.hints'),this.$question=this.$('.bubble.question'),this.$question.onKeyDown('enter',(a)=>{a.preventDefault();let e=this.$question.text.trim();e&&t.Tutor.ask(e),this.$question.text=''});const a=this.$panels[3],s=sortBy(Object.keys(t.glossary).map((e)=>t.glossary[e]),'title');let n=null;for(let e of s){let t=$N('div',{class:'item hover'},a);const s=$N('p',{html:e.title,class:'gloss-title'},t),i=$N('div',{html:e.text,class:'gloss-body'},t);s.on('click',()=>{t===n?(t.removeClass('on'),i.animate({height:0},300),n=null):(n&&(n.removeClass('on'),n.children[1].animate({height:0},300)),i.animate({height:'auto'},300),t.addClass('on'),n=t)})}}open(e){let t=this.active,a=this.$panels[e];if(this.active=e,clearTimeout(this.closeTimeout),null!==t){this.$buttons[t].removeClass('active');let s=this.$panels[t];s.transitionEnd(function(){s.hide(),s.removeClass('left')}),s.removeClass('active'),t<e&&s.addClass('left'),t>e&&a.addClass('left'),a.show(),Browser.redraw(),a.removeClass('left'),a.addClass('active')}else a.addClass('active'),a.show(),setTimeout(Browser.resize,400),this.trigger('open',e),this.addClass('open');a.scrollTop=Browser.height,this.$buttons[e].addClass('active')}close(){if(null===this.active)return;let e=this.$panels[this.active];this.$buttons[this.active].removeClass('active'),this.closeTimeout=setTimeout(()=>{e.hide(),e.removeClass('active'),Browser.resize()},400),this.removeClass('open'),this.active=null,this.trigger('close')}}registerElement('x-toolbox',Toolbox,{templateId:'#toolbox'});const colours$1=loop(['#b30469','#1f7aff','#31b304','#ff941f']);class Particle{constructor(e){this.x=Math.random()*Browser.width,this.y=(Math.random()-1)*Browser.height,this.r=uniform(10,30),this.color=colours$1(),this.index=e,this.tilt=_Mathfloor(10*Math.random())-10,this.tiltAngleIncrement=.07*Math.random()+.05,this.tiltAngle=0}draw(e){e.beginPath(),e.lineWidth=this.r/2,e.strokeStyle=this.color,e.moveTo(this.x+this.tilt+this.r/4,this.y),e.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),e.stroke()}update(e,t){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(_Mathcos(e)+3+this.r/2)/2,this.x+=_Mathsin(e),this.tilt=15*_Mathsin(this.tiltAngle-this.index/3),-20>this.x?(this.x=-20,this.y=Math.random()*Browser.height,this.tilt=_Mathfloor(10*Math.random())-20):this.x>Browser.width+20?(this.x=Browser.width+20,this.y=Math.random()*Browser.height,this.tilt=_Mathfloor(10*Math.random())-20):t&&this.y>Browser.height&&(this.x=Math.random()*Browser.width,this.y=-10,this.tilt=_Mathfloor(10*Math.random())-20)}}const style='position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999';let $confetti;class Section extends Evented{constructor(e){super(),this.$steps=[],this.title=e.html}get progress(){let e=this.$steps.reduce((e,t)=>e+t.goals.length,0),t=this.$steps.reduce((e,t)=>e+t.scores.size,0);return t/e||0}}const stepFunctions=window._stepFunctions||{};class Step extends CustomElement{created(){this.isShown=!1,this.isCompleted=!1,this.goals=words(this.attr('goals')||''),this.scores=new Set,this.model=observable({$step:this}),this.tools={confetti};const e=this.$('h2');this.section=e?new Section(e):null}ready(){this.$chapter=(this.getModel()||{}).$chapter,this.$wrap=this.$('.step-wrap'),this.hasClass('fill')&&this.$wrap.insertBefore($N('div',{class:'background'})),this.$blanks=this.$$('x-blank, x-blank-input'),this.$blanks.forEach((e,t)=>{this.goals.push('blank-'+t),e.on('valid',()=>{this.addHint('correct'),this.score('blank-'+t)}),e.on('invalid',()=>this.addHint('incorrect')),e.on('hint',(e)=>this.addHint(`Hmmm… maybe try ${e}?`))}),this.$reveals=this.$$('.reveal');for(let e of this.$reveals)e.data.display='visibility',this.onScore(e.data.when,()=>{'visible'===e.css('visibility')||e.enter(e.data.animation||'fade',400,+e.data.delay||0)});this.$nextBtn=this.$$('.next-step'),this.$nextBtn.forEach((e,t)=>{this.goals.push('next-'+t),this.onScore('next-'+t,()=>e.exit('pop')),e.one('click',()=>this.score('next-'+t))});for(let e of this.$$('.check[data-when]'))this.onScore(e.data.when,()=>e.addClass('visible'));for(const e of this.$$('.step-target'))e.on('hover',{enter:()=>{const t=this.$$('[target~="'+e.data.to+'"]');for(let e of t)e.addClass('focus');this.addClass('focus')},exit:()=>{for(let e of this.$$('.focus'))e.removeClass('focus');this.removeClass('focus')}});this.$slides=this.$('x-slideshow'),this.$slides&&(this.goals.push(...tabulate((e)=>'slide-'+e,this.$slides.length-1)),this.$slides.on('next',(e)=>this.score('slide-'+(e-1)))),this.$sortables=this.$$('x-sortable'),this.$sortables.forEach((e,t)=>{this.goals.push('sortable-'+t),e.on('solve',()=>{this.addHint('correct'),this.score('sortable-'+t)})}),this.$gameplay=this.$('x-gameplay'),this.$gameplay&&(this.goals.push('gameplay'),this.$gameplay.on('score',()=>this.score('gameplay')));for(let e of this.$$('.var'))e.bindObservable(this.model,!1)}show(e){if(!this.isShown){this.isShown=!0;try{const e=toCamelCase(this.id);e in stepFunctions&&stepFunctions[e](this)}catch(t){console.error(t)}e&&this.restore(e),setTimeout(()=>{if(!this.isReady)for(let e of this.$$('x-gesture'))'X-GEOPAD'!==e.parent.tagName&&e.start()},2e3),this.section&&this.section.trigger('show'),this.addClass('on')}}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(let e of this.$reveals)'visible'!==e.css('visibility')&&e.enter('fade',400);for(let e=0;e<this.$nextBtn.length;++e)this.score('next-'+e);this.trigger('complete')}}restore(e){this.$blanks.forEach((t,a)=>{0<=e.scores.indexOf('blank-'+a)&&t.solve()}),this.$sortables.forEach((t,a)=>{0<=e.scores.indexOf('sortable-'+a)&&t.solve()}),e.scores.forEach((e)=>this.score(e,!1))}get isReady(){return this.goals.every((e)=>this.scores.has(e))}score(e,t=!0){this.scores.has(e)||(this.scores.add(e),this.trigger('score-'+e),this.trigger('score'),this.section&&this.section.trigger('score'),this.$chapter&&(this.$chapter.saveProgress({steps:{[this.id]:{scores:[e]}}}),this.$chapter.log('score',this.id+':'+e)),t&&this.isReady&&this.$chapter&&this.$chapter.isReady&&setTimeout(()=>{this.$chapter.$activeStep===this&&this.$chapter.nextStep()},500))}onScore(e,t){if(e=words(e),e.every((e)=>this.scores.has(e)))return t();if(1===e.length)return this.one('score-'+e[0],t);const a=()=>{e.every((e)=>this.scores.has(e))&&(t(),this.off('score',a))};this.on('score',a)}addHint(e,t={}){return this.$chapter?this.$chapter.isReady?this.isInViewport?this.$chapter.Tutor.msg(e,t):void this.on('enterViewport',()=>this.$chapter.Tutor.msg(e,t)):void 0:this.trigger('hint',e)}getHelp(){}delayedHint(e,a=1e4){let t=setTimeout(e,a);this.on('score',()=>{clearTimeout(t),this.isCompleted||(t=setTimeout(e,2e4))}),this.on('complete',()=>clearTimeout(t))}}const template$1='<div class="step-wrap"><slot></slot></div>';registerElement('x-step',Step,{template:template$1});const MATHS_REGEX=/[0-9+\-*/()^\s]+/g,MESSAGES$1={welcome:'Hey, I\u2019m Archie. Welcome to Mathigon! I will guide you through this chapter, and you can ask me for hints or help.',tutorial1:'The content is revealed in small steps. As you answer questions and solve puzzles, more will be shown.',tutorial2:'The expandable <x-target to=".t-button.progress">sidebar</x-target> shows your current progress. You can skip ahead or reveal all steps immediately.',tutorial3:'Mathigon will save all your progress, so you can come back later and continue right where you left off.',createAccount:'Remember to <x-target to=".nav-link.dropdown-title">create an account</x-target>, to save your progress and see personalised content.'};let CORRECT=loop(['Well done :263a:','Great Work! :1f60c:','Awesome :1f600:','Brilliant :1f44d:','Excellent! :1f44c:','Cool :1f60e:','Nice! :270c:','Way to go! :1f60a:','Impressive! :1f3c6:','Outstanding :1f947:','Superb! :2b50:','Wonderful!']),INCORRECT=loop(['That\u2019s not quite right :2639:','Are you sure about that? :1f914:','That doesn\u2019t look right. :1f62f:','Try again! :1f615:']);const CORRECT_IMG=loop(['happy','spongebob','sloth','party','robot','excited','cute','highfive1','applause','highfive2']),INCORRECT_IMG=loop(['minions','panther','dog','snape','what','door','horrible']);class Tutor{constructor(e,t){this.$chapter=e,this.hints=t,this.recentMessages=[],this.startedTutorial=!1;for(let a of e.userData.hints||[])this._display(a,{instant:!0,toast:!1});this.$chapter.one('score',()=>{this.$chapter.user||this.startedTutorial||this._display({text:MESSAGES$1.createAccount},{store:!1})})}msg(e,{store:t=!0,timeout:a=8e3,force:s=!1}={}){if(isOneOf(e,'correct','incorrect')){t=!1;const s='correct'===e?CORRECT():INCORRECT(),n=this._display({text:parseEmoji(s)},{store:t,timeout:a,className:e});if(.2>Math.random()){const s='correct'===e?CORRECT_IMG():INCORRECT_IMG();this._display({img:`/images/gifs/${s}.gif`},{store:t,timeout:a})}return n}return isString(e)?s||!(0<=this.recentMessages.indexOf(e))?(this.recentMessages.push(e),setTimeout(()=>this.recentMessages.shift(),1e4),this._display({text:this.hints[e]||e})):void 0:this._display(e)}ask(question){this._display({question},{toast:!1,instant:!0}),this.$chapter.log('ask',question);let equation=(question.match(MATHS_REGEX)||[]).filter((e)=>3<=e.length&&!e.match(/^[\s0-9]+$/));if(equation.length)try{const result=eval(equation[0].replace(/\b0+/g,'0').replace(/\^/g,'**'));return this._display({text:'= '+result},{toast:!1})}catch(t){console.error('Could not parse',equation[0])}this.$chapter.$toolbox.$hints.addClass('loading'),post(window.location.pathname+'/ask',{query:question}).then((e)=>{this.$chapter.$toolbox.$hints.removeClass('loading');let t=JSON.parse(e);'mean'===t.mode&&meanEasterEgg();for(let a of t.messages)this._display(a,{toast:!1})}).catch((t)=>{console.error('Tutor error:',t),this.$chapter.$toolbox.$hints.removeClass('loading')})}tutorial(e=!1){if(!e&&this.$chapter.user&&this.$chapter.user.tutorial)return;if(!e&&Browser.getCookie('hide_tutorial'))return;const t=()=>{Browser.setCookie('hide_tutorial',1),this.$chapter.saveProgress({tutorial:!0})},a=()=>{this._display({text:'Enjoy using Mathigon!'},{store:!1}),t()},s=()=>{this._display({text:this.$chapter.user?MESSAGES$1.tutorial3:MESSAGES$1.createAccount,buttons:[{text:'Ready!',callback:a}]},{timeout:null,store:!1})},n=()=>{this._display({text:MESSAGES$1.tutorial2,buttons:[{text:'Continue',callback:s}]},{timeout:null,store:!1})};this._display({text:MESSAGES$1.welcome,buttons:[{text:'Show tutorial',callback:()=>{this.startedTutorial=!0,this.$chapter.log('start-tutorial'),this._display({text:MESSAGES$1.tutorial1,buttons:[{text:'Continue',callback:n}]},{timeout:null,store:!1}),t()}},{text:'Skip',callback:a}]},{timeout:null,store:!1})}_display(e,{store:t=!0,timeout:a=8e3,toast:s=!0,instant:n=!1,className:i=''}={}){t&&this.$chapter.saveProgress({hints:[e]}),640>Browser.width&&(a*=.7);const o=this.$chapter.$toolbox;let r;if(s&&!o.active){if(r=createBubble(e,this.$chapter.$toastPanel,'toast'),r.$('.bubble').on('click',(t)=>{t.handled||o.open(1)}),i&&r.addClass(i),e.buttons){let t=$N('div',{class:'toast-buttons'},r);e.buttons.forEach((e)=>{let a=$N('button',{class:'btn',html:e.text},t);a.one('click',()=>u(e))})}r.enter('slide-down')}let l=createBubble(e,o.$hints,'item'),d=1===o.active&&!n;d&&l.enter('slide-down-'+(e.question?'right':'left'),300);const c=(e.buttons||[]).map((e)=>{let t=$N('div',{class:'item'},this.$chapter.$toolbox.$hints),a=$N('div',{class:'bubble question button',html:e.text},t);return d&&t.enter('slide-down-right',300),a.one('click',()=>u(e)),t});let p=this.$chapter.$toolbox.$panels[1];animate(()=>{p.scrollTop=p.scrollHeight},d?200:0);const h=()=>{r&&r.exit('slide-left-up').then(()=>r.remove())};let g=!1;const u=(a)=>{g||(g=!0,a.callback&&a.callback(),t&&this.$chapter.saveProgress({hints:[{question:a.text}]}),c.forEach((t,s)=>{a===e.buttons[s]?setTimeout(()=>t.$('.bubble').removeClass('button'),200):t.exit('slide-up-right',200).then(()=>t.remove())}),h())};return a&&setTimeout(h,a),e}}class Chapter extends CustomElement{created(){this.model={$chapter:this},this.user=window.user,this.isCompleted=!1,this.isReady=!1,this.glossary=JSON.parse(this.$('#glossary').text)||{},this.userData=JSON.parse(this.$('#userdata').text)||{},this.$steps=this.$$('x-step'),this.$activeStep=null,this.sections=[];for(let e of this.$steps)e.section?this.sections.push(e.section):e.section=last(this.sections),last(this.sections).$steps.push(e)}ready(){this.$header=this.$('.hero'),this.$footer=this.$('footer'),this.$toastPanel=this.$('.toast-panel'),this.$nextBanner=this.$footer.$('.next-banner'),this.$toolbox=this.$('x-toolbox'),this.$toolbox.on('open',()=>this.addClass('toolbox-open')),this.$toolbox.on('close',()=>this.removeClass('toolbox-open'));const e=JSON.parse(this.$('#hints').text)||{};this.Tutor=new Tutor(this,e),this.$footer.$('.skip').on('click',()=>this.nextStep());const t=this.$footer.$$('.share-row .btn:not(.feedback)');for(let e of t){const t=e.attr('href');e.on('click',(a)=>{a.preventDefault(),window.open(t,'',`menubar=no,toolbar=no,width=720,height=640,top=${window.screen.height/2-320},left=${window.screen.width/2-360}`)})}const a=this.userData.steps||{},s=this.findStep(Browser.hash);this.$activeStep=this.findStep(this.userData.activeStep)||this.$steps[0];for(let e of this.$steps){if(e.show(a[e.id]),e===this.$activeStep)break;e.complete()}if(this.userData.completed||'full'===Browser.hash)this.complete();else for(;this.$activeStep&&this.$activeStep.isReady;)this.nextStep();s?this.goToStep(s,!1):this.$activeStep&&this.userData.activeStep&&this.goToStep(this.$activeStep,!1),!this.isCompleted&&640<Browser.width&&setTimeout(()=>this.Tutor.tutorial(),1500),Browser.onKey('space',(t)=>{t.preventDefault(),this.nextStep()}),this.isReady=!0,Browser.resize(()=>this.resize()),setTimeout(()=>{Browser.redraw(),this.addClass('ready')}),this.log('start')}nextStep(){if(this.isCompleted)return;let e=this.$activeStep;this.animateNextBanner();do{if(e.complete(),e=this.$steps[this.$steps.indexOf(e)+1],!e)return this.complete(!0);e.show()}while(e.isReady);this.$activeStep=e,this.saveProgress({activeStep:e.id}),this.resize()}goToStep(e,t=!0){t&&this.animateNextBanner();for(let a of this.$steps){if(a.show(),e.isShown&&!a.isReady){this.$activeStep=a;break}a.complete()}const a=e.positionTop-_Mathmax(50,(Browser.height-e.height)/2);t?$body.scrollTo(a):$body.scrollTop=a,this.saveProgress({activeStep:this.$activeStep.id}),this.resize()}complete(e=!1){if(!this.isCompleted){this.isCompleted=!0,this.$steps.forEach((e)=>e.complete()),this.$activeStep=null;const t=this.$footer.$('.completed-box'),a=this.$footer.$('.next-up');e?(this.$nextBanner.exit('fade',200),t.enter('pop',400),a&&a.enter('fade',300,400)):(this.$nextBanner.hide(),t.show(),a&&a.show()),this.$footer.one('enterViewport',()=>confetti()),this.resize(),this.saveProgress({completed:!0}),this.log('complete')}}findStep(e){for(let t of this.$steps)if(t.id===e)return t}resize(){const e=this.$steps.map((e)=>e.$wrap.height),t=this.$header.height+total(e)+this.$footer.height;this.trigger('resize',{steps:e,fullHeight:t})}animateNextBanner(){this.$nextBanner.css({top:this.$nextBanner.bounds.top+'px',width:this.$nextBanner.width+'px'}),this.$nextBanner.addClass('fixed'),this.$nextBanner.animate({transform:'translateY(100px)'}).then(()=>{this.$nextBanner.removeClass('fixed'),this.$nextBanner.css({top:'',width:'',transform:''})})}get progress(){let e=this.$steps.reduce((e,t)=>e+t.goals.length,0),t=this.$steps.reduce((e,t)=>e+t.scores.size,0);return t/e||0}saveProgress(e){!this.isReady||this.user&&(e.progress=this.progress,deferredPost(this.data.id,e))}log(e,t=''){window.ga&&this.isReady&&window.ga('send','event','Course',e+':'+t,this.data.id)}}registerElement('x-chapter',Chapter,{templateId:'#chapter'});class Dropdown extends CustomElement{ready(){this.$title=this.$('.dropdown-title'),this.$body=this.$('.dropdown-body'),this.isOpen=!1,this.$title.on('click',()=>{this.toggle()}),this.$$('a').forEach((e)=>{e.on('click',()=>{this.hide()})}),this.on('clickOutside',()=>{this.hide()})}show(){this.isOpen||(this.isOpen=!0,this.addClass('open'),this.$body.enter('fade',200))}hide(){this.isOpen&&(this.isOpen=!1,this.removeClass('open'),this.$body.exit('fade',200))}toggle(){this.isOpen?this.hide():this.show()}}registerElement('x-dropdown',Dropdown);class Select extends CustomElement{ready(){const e=this.children;this.$active=this.$('.active')||e[0],this.$active.addClass('active');for(let t of e)t.on('click',()=>this.makeActive(t));this.trigger('change',this.$active)}makeActive(e){e===this.$active||(this.$active.removeClass('active'),this.$active=e,e.addClass('active'),this.trigger('change',e))}}registerElement('x-select',Select);const VERSION='2.4.1',DEV_ID='i5iSjo',VERSION_PARAM='_av',USAGE_PARAM='_au',NULL_DIMENSION='(not set)',instances=[];class MethodChain{static add(e,t,a){getOrCreateMethodChain(e,t).add(a)}static remove(e,t,a){getOrCreateMethodChain(e,t).remove(a)}constructor(e,t){this.context=e,this.methodName=t,this.isTask=/Task$/.test(t),this.originalMethodReference=this.isTask?e.get(t):e[t],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...e)=>{const t=this.boundMethodChain[this.boundMethodChain.length-1];return t(...e)},this.isTask?e.set(t,this.wrappedMethod):e[t]=this.wrappedMethod}add(e){this.methodChain.push(e),this.rebindMethodChain()}remove(e){const t=this.methodChain.indexOf(e);-1<t&&(this.methodChain.splice(t,1),0<this.methodChain.length?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let e,t=0;e=this.methodChain[t];t++){const a=this.boundMethodChain[t-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(e(a))}}destroy(){const e=instances.indexOf(this);-1<e&&(instances.splice(e,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}}const proto=window.Element.prototype,nativeMatches=proto.matches||proto.matchesSelector||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector,a=document.createElement('a'),queueMap={},assign=Object.assign||function(e,...t){for(let a=0,s=t.length;a<s;a++){const s=Object(t[a]);for(let t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},uuid=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):'10000000-1000-4000-8000-100000000000'.replace(/[018]/g,e)};class EventEmitter{constructor(){this.registry_={}}on(e,t){this.getRegistry_(e).push(t)}off(e=void 0,t=void 0){if(e&&t){const a=this.getRegistry_(e),s=a.indexOf(t);-1<s&&a.splice(s,1)}else this.registry_={}}emit(e,...t){this.getRegistry_(e).forEach((e)=>e(...t))}getEventCount(){let e=0;return Object.keys(this.registry_).forEach((t)=>{e+=this.getRegistry_(t).length}),e}getRegistry_(e){return this.registry_[e]=this.registry_[e]||[]}}const AUTOTRACK_PREFIX='autotrack',instances$1={};let browserSupportsLocalStorage,isListening=!1;class Store extends EventEmitter{static getOrCreate(e,t,a){const s=[AUTOTRACK_PREFIX,e,t].join(':');return instances$1[s]||(instances$1[s]=new Store(s,a),!isListening&&initStorageListener()),instances$1[s]}static isSupported_(){if(null!=browserSupportsLocalStorage)return browserSupportsLocalStorage;try{window.localStorage.setItem(AUTOTRACK_PREFIX,AUTOTRACK_PREFIX),window.localStorage.removeItem(AUTOTRACK_PREFIX),browserSupportsLocalStorage=!0}catch(e){browserSupportsLocalStorage=!1}return browserSupportsLocalStorage}static get_(e){return window.localStorage.getItem(e)}static set_(e,t){window.localStorage.setItem(e,t)}static clear_(e){window.localStorage.removeItem(e)}constructor(e,t={}){super(),this.key_=e,this.defaults_=t,this.cache_=null}get(){if(this.cache_)return this.cache_;if(Store.isSupported_())try{this.cache_=parse$1(Store.get_(this.key_))}catch(e){}return this.cache_=assign({},this.defaults_,this.cache_)}set(e){if(this.cache_=assign({},this.defaults_,this.cache_,e),Store.isSupported_())try{Store.set_(this.key_,JSON.stringify(this.cache_))}catch(e){}}clear(){if(this.cache_={},Store.isSupported_())try{Store.clear_(this.key_)}catch(e){}}destroy(){delete instances$1[this.key_],Object.keys(instances$1).length||removeStorageListener()}}const SECONDS=1e3,MINUTES=60*SECONDS,instances$2={};class Session{static getOrCreate(e,t,a){const s=e.get('trackingId');return instances$2[s]?instances$2[s]:instances$2[s]=new Session(e,t,a)}constructor(e,t,a){this.tracker=e,this.timeout=t||Session.DEFAULT_TIMEOUT,this.timeZone=a,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),MethodChain.add(e,'sendHitTask',this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat('en-US',{timeZone:this.timeZone})}catch(e){}this.store=Store.getOrCreate(e.get('trackingId'),'session',{hitTime:0,isExpired:!1}),this.store.get().id||this.store.set({id:uuid()})}getId(){return this.store.get().id}isExpired(e=this.getId()){if(e!=this.getId())return!0;const t=this.store.get();if(t.isExpired)return!0;const a=t.hitTime;if(a){const e=new Date,t=new Date(a);if(e-t>this.timeout*MINUTES||this.datesAreDifferentInTimezone(e,t))return!0}return!1}datesAreDifferentInTimezone(e,t){return!!this.dateTimeFormatter&&this.dateTimeFormatter.format(e)!=this.dateTimeFormatter.format(t)}sendHitTaskOverride(e){return(t)=>{e(t);const a=t.get('sessionControl'),s='start'==a||this.isExpired(),n=this.store.get();n.hitTime=now(),s&&(n.isExpired=!1,n.id=uuid()),'end'==a&&(n.isExpired=!0),this.store.set(n)}}destroy(){MethodChain.remove(this.tracker,'sendHitTask',this.sendHitTaskOverride),this.store.destroy(),delete instances$2[this.tracker.get('trackingId')]}}Session.DEFAULT_TIMEOUT=30;const plugins={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},PLUGIN_COUNT=Object.keys(plugins).length,HIDDEN='hidden',VISIBLE='visible',PAGE_ID=uuid(),SECONDS$1=1e3;class PageVisibilityTracker{constructor(e,t){if(trackUsage(e,plugins.PAGE_VISIBILITY_TRACKER),!!document.visibilityState){const a={sessionTimeout:Session.DEFAULT_TIMEOUT,visibleThreshold:5*SECONDS$1,sendInitialPageview:!1,fieldsObj:{}};this.opts=assign(a,t),this.tracker=e,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=Store.getOrCreate(e.get('trackingId'),'plugins/page-visibility-tracker'),this.store.on('externalSet',this.handleExternalStoreSet),this.session=Session.getOrCreate(e,this.opts.sessionTimeout,this.opts.timeZone),MethodChain.add(e,'set',this.trackerSetOverride),window.addEventListener('unload',this.handleWindowUnload),document.addEventListener('visibilitychange',this.handleChange),deferUntilPluginsLoaded(this.tracker,()=>{document.visibilityState==VISIBLE?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:now(),state:VISIBLE,pageId:PAGE_ID,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}}handleChange(){if(document.visibilityState!=VISIBLE&&document.visibilityState!=HIDDEN)return;const e=this.getAndValidateChangeData(),t={time:now(),state:document.visibilityState,pageId:PAGE_ID,sessionId:this.session.getId()};document.visibilityState==VISIBLE&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),document.visibilityState==HIDDEN&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(e.sessionId)?(this.store.clear(),this.lastPageState==HIDDEN&&document.visibilityState==VISIBLE&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(t),this.sendPageview({hitTime:t.time})},this.opts.visibleThreshold))):(e.pageId==PAGE_ID&&e.state==VISIBLE&&this.sendPageVisibilityEvent(e),this.store.set(t)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){const e=this.store.get();return this.lastPageState==VISIBLE&&e.state==HIDDEN&&e.pageId!=PAGE_ID&&(e.state=VISIBLE,e.pageId=PAGE_ID,this.store.set(e)),e}sendPageVisibilityEvent(e,{hitTime:t}={}){const a=this.getTimeSinceLastStoredChange(e,{hitTime:t});if(a&&a>=this.opts.visibleThreshold){const e=_Mathround(a/SECONDS$1),s={transport:'beacon',nonInteraction:!0,eventCategory:'Page Visibility',eventAction:'track',eventValue:e,eventLabel:NULL_DIMENSION};t&&(s.queueTime=now()-t),this.opts.visibleMetricIndex&&(s['metric'+this.opts.visibleMetricIndex]=e),this.tracker.send('event',createFieldsObj(s,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){const e={transport:'beacon',eventCategory:'Page Visibility',eventAction:'page load',eventLabel:NULL_DIMENSION,['metric'+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send('event',createFieldsObj(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:e,isPageLoad:t}={}){const a={transport:'beacon'};e&&(a.queueTime=now()-e),t&&this.opts.pageLoadsMetricIndex&&(a['metric'+this.opts.pageLoadsMetricIndex]=1),this.tracker.send('pageview',createFieldsObj(a,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(e){return(t,a)=>{const s=isObject$1(t)?t:{[t]:a};s.page&&s.page!==this.tracker.get('page')&&this.lastPageState==VISIBLE&&this.handleChange(),e(t,a)}}getTimeSinceLastStoredChange(e,{hitTime:t}={}){return e.time?(t||now())-e.time:0}handleExternalStoreSet(e,t){e.time!=t.time&&(t.pageId!=PAGE_ID||t.state!=VISIBLE||this.session.isExpired(t.sessionId)||this.sendPageVisibilityEvent(t,{hitTime:e.time}))}handleWindowUnload(){this.lastPageState!=HIDDEN&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),MethodChain.remove(this.tracker,'set',this.trackerSetOverride),window.removeEventListener('unload',this.handleWindowUnload),document.removeEventListener('visibilitychange',this.handleChange)}}provide('pageVisibilityTracker',PageVisibilityTracker),window.$=$,window.$$=$$,window.Browser=Browser,Browser.replaceSvgImports(),setTimeout(()=>{$html.addClass('ready')}),$html.addClass((Browser.isMobile?'is':'not')+'-mobile')})();
